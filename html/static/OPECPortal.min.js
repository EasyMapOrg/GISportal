var COMPILED=!0,goog=goog||{};goog.NODE_JS=!1;goog.global=goog.NODE_JS?eval("global"):this;goog.DEBUG=!0;goog.LOCALE="en";goog.provide=function(a){if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a];for(var b=a;(b=b.substring(0,b.lastIndexOf(".")))&&!goog.getObjectByName(b);)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)};
goog.setTestOnly=function(a){if(COMPILED&&!goog.DEBUG)throw a=a||"",Error("Importing test-only code into non-debug environment"+a?": "+a:".");};COMPILED||(goog.isProvided_=function(a){return!goog.implicitNamespaces_[a]&&!!goog.getObjectByName(a)},goog.implicitNamespaces_={});goog.isExistingGlobalVariable_=function(a){return"undefined"!==String(eval("typeof "+a))};
goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;!(a[0]in c)&&c.execScript&&c.execScript("var "+a[0]);goog.NODE_JS&&c===goog.global&&goog.isExistingGlobalVariable_(a[0])&&(c=eval(a[0]),a.shift());for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};
goog.getObjectByName=function(a,b){var c=a.split("."),d=b||goog.global;goog.NODE_JS&&d===goog.global&&goog.isExistingGlobalVariable_(c[0])&&(d=eval(c[0]),c.shift());for(var f;f=c.shift();)if(goog.isDefAndNotNull(d[f]))d=d[f];else return null;return d};goog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};
goog.addDependency=function(a,b,c){if(!COMPILED){for(var d,a=a.replace(/\\/g,"/"),f=goog.dependencies_,e=0;d=b[e];e++)f.nameToPath[d]=a,a in f.pathToNames||(f.pathToNames[a]={}),f.pathToNames[a][d]=!0;for(d=0;b=c[d];d++)a in f.requires||(f.requires[a]={}),f.requires[a][b]=!0}};goog.ENABLE_DEBUG_LOADER=!0;
goog.require=function(a){if(!COMPILED&&!goog.isProvided_(a)){if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b){goog.included_[b]=!0;goog.writeScripts_();return}}a="goog.require could not find: "+a;goog.global.console&&goog.global.console.error(a);throw Error(a);}};goog.basePath="";goog.nullFunction=function(){};goog.identityFunction=function(a){return a};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};
goog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];
!COMPILED&&goog.ENABLE_DEBUG_LOADER&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("script"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?"),d=
-1==d?c.length:d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a){var b=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[a]&&b(a)&&(goog.dependencies_.written[a]=!0)},goog.writeScriptTag_=function(a){return goog.inHtmlDocument_()?(goog.global.document.write('<script type="text/javascript" src="'+a+'"><\/script>'),!0):!1},goog.writeScripts_=function(){function a(f){if(!(f in d.written)){if(!(f in d.visited)&&(d.visited[f]=
!0,f in d.requires))for(var g in d.requires[f])if(!goog.isProvided_(g))if(g in d.nameToPath)a(d.nameToPath[g]);else throw Error("Undefined nameToPath for "+g);f in c||(c[f]=!0,b.push(f))}}var b=[],c={},d=goog.dependencies_,f;for(f in goog.included_)d.written[f]||a(f);for(f=0;f<b.length;f++)if(b[f])goog.importScript_(goog.basePath+b[f]);else throw Error("Undefined script input");},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),
goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isDef=function(a){return void 0!==a};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};
goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};
goog.UID_PROPERTY_="closure_uid_"+Math.floor(2147483648*Math.random()).toString(36);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};
goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){goog.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bindNative_:goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=Array.prototype.slice.call(arguments);d.unshift.apply(d,c);return a.apply(this,d)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));b.body.appendChild(c);
b.body.removeChild(c)}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(a,b){var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){for(var a=a.split("-"),d=[],b=0;b<a.length;b++)d.push(c(a[b]));return d.join("-")},d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};return b?a+"-"+d(b):d(a)};goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};
!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b){var c=b||{},d;for(d in c)var f=(""+c[d]).replace(/\$/g,"$$$$"),a=a.replace(RegExp("\\{\\$"+d+"\\}","gi"),f);return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a};
goog.base=function(a,b,c){var d=arguments.callee.caller;if(d.superClass_)return d.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var f=Array.prototype.slice.call(arguments,2),e=!1,g=a.constructor;g;g=g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)e=!0;else if(e)return g.prototype[b].apply(a,f);if(a[b]===d)return a.constructor.prototype[b].apply(a,f);throw Error("goog.base called from a method of one name to a method of a different name");};
goog.scope=function(a){a.call(goog.global)};$(document).ready(function(){window.console||(window.console={});window.console.log||(window.console.log=function(){});main()});(function(a){var b={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},c={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};a.widget("opec.extendedDialog",{version:"1.10.1",options:{appendTo:"body",autoOpen:!0,buttons:[],titlebarButtons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(d){var b=
a(this).css(d).offset().top;0>b&&a(this).css("top",d.top-b)}},resizable:!0,show:null,title:null,width:300,showClose:!0,showMaximise:!1,showMinimise:!1,showHelp:!0,dblclick:!1,titlebar:!1,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null,load:null,beforeCollapse:null,beforeMaximise:null,beforeMinimise:null,beforeRestore:null,collapse:null,maximise:null,minimise:null,restore:null,help:null},_create:function(){this.originalCss=
{display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height};this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)};this.originalTitle=this.element.attr("title");this.options.title=this.options.title||this.originalTitle;this._createWrapper();this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog);
this._createTitlebar();this._createButtonPane();this.options.draggable&&a.fn.draggable&&this._makeDraggable();this.options.resizable&&a.fn.resizable&&this._makeResizable();this._isOpen=!1;this._setState("normal")},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var d=this.options.appendTo;return d&&(d.jquery||d.nodeType)?a(d):this.document.find(d||"body").eq(0)},_destroy:function(){var a,b=this.originalPosition;this._destroyOverlay();this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach();
this.uiDialog.stop(!0,!0).remove();this.originalTitle&&this.element.attr("title",this.originalTitle);a=b.parent.children().eq(b.index);a.length&&a[0]!==this.element[0]?a.before(this.element):b.parent.append(this.element)},widget:function(){return this.uiDialog},disable:a.noop,enable:a.noop,state:function(){return a(this).data("dialog-state")},collapse:function(){var a=this.uiDialog.find(".ui-dialog-titlebar").height()+15;this._trigger("beforeCollapse");this._saveSnapshot();this.element.css({resizable:!1,
height:a,maxHeight:a});this.uiDialog.find(".ui-dialog-content").hide();this.uiDialog.find(".ui-dialog-buttonpane:visible").hide().end().find(".ui-dialog-titlebar").css("white-space","nowrap").end();this._setState("collapsed");this._trigger("collapse")},minimise:function(){var b=this;this.uiDialog.find(".ui-dialog-titlebar").height();var c=a("#dialog-fixed-container").length?a("#dialog-fixed-container"):a('<div id="dialog-fixed-container"></div>').appendTo("body");a(c).css({position:"fixed",bottom:1,
left:1,"z-index":9999,width:1});b._trigger("beforeMinimize");b._saveSnapshot();b.uiDialog.css({"float":"left",margin:1,position:"static"});b.uiDialog.appendTo(c);b.uiDialog.css({width:200});b.uiDialog.css("height","auto");b.uiDialog.find(".ui-dialog-titlebar").each(function(){var c=b.uiDialog.find(".ui-dialog-titlebar-buttonpane"),f=b.uiDialog.find(".ui-dialog-title");a(f).css({overflow:"hidden",width:a(this).width()-a(c).width()+10})}).end();b.uiDialog.find(".ui-dialog-content").hide();b.uiDialog.find(".ui-dialog-buttonpane:visible").hide().end().find(".ui-dialog-titlebar").css("white-space",
"nowrap").end();b.uiDialog.draggable("option","handle",null).find(".ui-dialog-draggable-handle").css("cursor","text").end().find(".ui-dialog-content");b._setState("minimised");b._toggleButtons();b._trigger("minimise")},restore:function(a){this._trigger("beforeRestore",a);this._restoreWithoutTriggerEvent();this._setState("normal");this._toggleButtons();this._trigger("restore")},close:function(b){var c=this;this._isOpen&&!1!==this._trigger("beforeClose",b)&&(this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||
a(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,function(){c._trigger("close",b)}))},help:function(a){this._trigger("help",a)},isOpen:function(){return this._isOpen},isMinimised:function(){var a=this.state();return"undefined"!==typeof a&&"minimised"==a},isMaximised:function(){var a=this.state();return"undefined"!==typeof a&&"maximised"==a},isCollapsed:function(){var a=this.state();return"undefined"!==typeof a&&"collapsed"==a},isNormal:function(){var a=this.state();
return"undefined"!==typeof a&&"normal"==a},moveToTop:function(){this._moveToTop()},_moveToTop:function(a,b){var c=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;c&&!b&&this._trigger("focus",a);return c},open:function(){var b=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=a(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){b._focusTabbable();
b._trigger("focus")}),this._trigger("open"))},_restoreWithoutTriggerEvent:function(){var b=this.state();"maximised"==b?this._restoreFromMaximised():"minimised"==b?this._restoreFromMinimised():"collapsed"==b?this._restoreFromCollapsed():"normal"==b?this._restoreFromNormal():a.error("jQuery.dialogExtend Error : Cannot restore dialog from unknown state '"+b+"'")},_setState:function(b){a(this).data("dialog-state",b);this.element.removeClass("ui-dialog-normal ui-dialog-maximised ui-dialog-minimised ui-dialog-collapsed");
this.element.addClass("ui-dialog-"+b)},_saveSnapshot:function(){var b=this.options;this.isNormal()&&a(this).data("original-config-resizable",b.resizable).data("original-config-draggable",b.draggable).data("original-size-height",b.height).data("original-size-width",b.width).data("original-size-maxHeight",b.maxHeight).data("original-size-minHeight",b.minHeight).data("original-size-maxWidth",b.maxWidth).data("original-size-minWidth",b.minWidth).data("original-position-mode",this.uiDialog.css("position")).data("original-position-left",
this.uiDialog.offset().left).data("original-position-top",this.uiDialog.offset().top).data("original-titlebar-wrap",this.uiDialog.find(".ui-dialog-titlebar").css("white-space")).data("original-element-height",this.uiDialog.css("height")).data("original-element-width",this.uiDialog.css("width"))},_loadSnapshot:function(){return{config:{resizable:a(this).data("original-config-resizable"),draggable:a(this).data("original-config-draggable")},size:{height:a(this).data("original-size-height"),width:a(this).data("original-size-width"),
maxHeight:a(this).data("original-size-maxHeight"),minHeight:a(this).data("original-size-minHeight"),maxWidth:a(this).data("original-size-maxWidth"),minWidth:a(this).data("original-size-minWidth"),elementHeight:a(this).data("original-element-height"),elementWidth:a(this).data("original-element-width")},position:{mode:a(this).data("original-position-mode"),left:a(this).data("original-position-left"),top:a(this).data("original-position-top")},titlebar:{wrap:a(this).data("original-titlebar-wrap")}}},
_toggleButtons:function(){this.uiDialog.find(".ui-dialog-titlebar-maximise").toggle(!this.isMaximised()&&this.options.showMaximise).end().find(".ui-dialog-titlebar-minimise").toggle(!this.isMinimised()&&this.options.showMinimise).end().find(".ui-dialog-titlebar-restore").toggle(!this.isNormal()&&(this.options.showMaximise||this.options.showMinimise)).end()},_restoreFromCollapsed:function(){var a=this._loadSnapshot();this.uiDialog.find(".ui-dialog-content").show();this.uiDialog.find(".ui-dialog-buttonpane:hidden").show().end().find(".ui-dialog-titlebar").css("white-space",
a.titlebar.wrap).end();this.options.resizable=a.config.resizable;this.options.height=a.size.height;this.options.maxHeight=a.size.maxHeight;this.options.minHeight=a.size.minHeight;this.uiDialog.css("height",a.size.elementHeight);this.uiDialog.css("width",a.size.elementWidth);this._size();this._position()},_restoreFromNormal:function(){},_restoreFromMinimised:function(){var b=this._loadSnapshot();this.uiDialog.appendTo("body").css({"float":"none",margin:0,position:b.position.mode});this.uiDialog.find(".ui-dialog-title").css({width:"auto"}).end().find(".ui-dialog-content").show();
this.uiDialog.find(".ui-dialog-buttonpane:hidden").show().end().find(".ui-dialog-titlebar").css("white-space",b.titlebar.wrap).end().find(".ui-dialog-content");this.options.resizable=b.config.resizable;this.options.draggable=b.config.draggable;this.options.height=b.size.height;this.options.width=b.size.width;this.options.maxHeight=b.size.maxHeight;this.options.minHeight=b.size.minHeight;this.options.maxWidth=b.size.maxWidth;this.options.minWidth=b.size.minWidth;this.uiDialog.css("height",b.size.elementHeight);
this.uiDialog.css("width",b.size.elementWidth);this.element.css("position",[b.position.left,b.position.top]);this.uiDialog.draggable("option","handle",a(this).find(".ui-dialog-draggable-handle")).find(".ui-dialog-draggable-handle").css("cursor","move");this._size();this._position()},_focusTabbable:function(){var a=this.element.find("[autofocus]");a.length||(a=this.element.find(":tabbable"));a.length||(a=this.uiDialogButtonPane.find(":tabbable"));a.length||(a=this.uiDialog);a.eq(0).focus()},_keepFocus:function(b){function c(){var b=
this.document[0].activeElement;this.uiDialog[0]===b||a.contains(this.uiDialog[0],b)||this._focusTabbable()}b.preventDefault();c.call(this);this._delay(c)},_createWrapper:function(){this.uiDialog=a("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo());this._on(this.uiDialog,{keydown:function(b){if(this.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE)b.preventDefault(),
this.close(b);else if(b.keyCode===a.ui.keyCode.TAB){var c=this.uiDialog.find(":tabbable"),e=c.filter(":first"),c=c.filter(":last");if((b.target===c[0]||b.target===this.uiDialog[0])&&!b.shiftKey)e.focus(1),b.preventDefault();else if((b.target===e[0]||b.target===this.uiDialog[0])&&b.shiftKey)c.focus(1),b.preventDefault()}},mousedown:function(a){this.isMinimised()||this._moveToTop(a)&&this._focusTabbable()}});this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},
_createTitlebar:function(){var b,c=this.options;this.uiDialogTitlebar=a("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog).select(function(){return!1});this._on(this.uiDialogTitlebar,{mousedown:function(b){a(b.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()},dblclick:function(){c.dblclick&&c.dblclick.length&&(this.isNormal()?"collapse"==c.dblclick?this.collapse():"minimise"==c.dblclick&&this.minimise():this.restore())}});
this.uiDialogTitlebarButtonPane=a("<div>").addClass("ui-dialog-titlebar-buttonpane").appendTo(this.uiDialogTitlebar);this._createTitlebarButtons();b=a("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar);this._title(b);this.uiDialog.attr({"aria-labelledby":b.attr("id")})},_title:function(a){this.options.title||a.html("&#160;");a.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=a("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");
this.uiButtonSet=a("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane);this._createButtons()},_createButtons:function(){var b=this,c=this.options.buttons;this.uiDialogButtonPane.remove();this.uiButtonSet.empty();a.isEmptyObject(c)||a.isArray(c)&&!c.length?this.uiDialog.removeClass("ui-dialog-buttons"):(a.each(c,function(c,f){var i,j,f=a.isFunction(f)?{click:f,text:c}:f,f=a.extend({type:"button"},f);i=f.click;f.click=function(){i.apply(b.element[0],arguments)};j={icons:f.icons,
text:f.showText};delete f.icons;delete f.showText;a("<button></button>",f).button(j).appendTo(b.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_createTitlebarButtons:function(){var b=this,c=this.options.titlebarButtons;if(a.isEmptyObject(c)||a.isArray(c)&&!c.length)c=[];a.isArray(c)&&(this.options.showHelp&&c.push({text:"help",icons:{primary:"ui-icon-help"},click:function(a){a.preventDefault();b.help(a)},classes:"ui-dialog-titlebar-help"}),
this.options.showMinimise&&c.push({text:"minimise",icons:{primary:"ui-icon-minus"},click:function(a){a.preventDefault();b.minimise(a)},classes:"ui-dialog-titlebar-minimise"}),c.push({text:"restore",icons:{primary:"ui-icon-newwin"},click:function(a){a.preventDefault();b.restore(a)},classes:"ui-dialog-titlebar-restore"}),this.options.showMaximise&&c.push({text:"maximise",icons:{primary:"ui-icon-extlink"},click:function(a){a.preventDefault();b.maximise(a)},classes:"ui-dialog-titlebar-maximise"}),this.options.showClose&&
c.push({text:"close",icons:{primary:"ui-icon-closethick"},click:function(a){a.preventDefault();b.close(a)},classes:"ui-dialog-titlebar-close"}));a.each(c,function(c,f,i,j){var k,i=a.isFunction(f)?{click:i,text:c,icon:f,classes:j}:f,i=a.extend({type:"button"},i);k=i.click;i.click=function(){k.apply(b.element[0],arguments)};c={icons:i.icons,text:!1};delete i.icons;delete i.showText;a("<button></button>",i).button(c).addClass(i.classes).appendTo(b.uiDialogTitlebarButtonPane)});b.uiDialogTitlebarButtonPane.find(".ui-dialog-titlebar-restore").hide()},
_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var c=this,e=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(e,i){a(this).addClass("ui-dialog-dragging");c._blockFrames();c._trigger("dragStart",e,b(i))},drag:function(a,e){c._trigger("drag",a,b(e))},stop:function(g,i){e.position=[i.position.left-c.document.scrollLeft(),i.position.top-c.document.scrollTop()];
a(this).removeClass("ui-dialog-dragging");c._unblockFrames();c._trigger("dragStop",g,b(i))}})},_makeResizable:function(){function b(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}var c=this,e=this.options,g=e.resizable,i=this.uiDialog.css("position"),g="string"===typeof g?g:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:e.maxWidth,maxHeight:e.maxHeight,minWidth:e.minWidth,
minHeight:this._minHeight(),handles:g,start:function(e,g){a(this).addClass("ui-dialog-resizing");c._blockFrames();c._trigger("resizeStart",e,b(g))},resize:function(a,e){c._trigger("resize",a,b(e))},stop:function(g,i){e.height=a(this).height();e.width=a(this).width();a(this).removeClass("ui-dialog-resizing");c._unblockFrames();c._trigger("resizeStop",g,b(i))}}).css("position",i)},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(){var a=
this.uiDialog.is(":visible");a||this.uiDialog.show();this.uiDialog.position(this.options.position);a||this.uiDialog.hide()},_setOptions:function(d){var f=this,e=!1,g={};a.each(d,function(a,d){f._setOption(a,d);a in b&&(e=!0);a in c&&(g[a]=d)});e&&(this._size(),this._position());this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",g)},_setOption:function(a,b){var c,g=this.uiDialog;"dialogClass"===a&&g.removeClass(this.options.dialogClass).addClass(b);"disabled"!==a&&(this._super(a,
b),"appendTo"===a&&this.uiDialog.appendTo(this._appendTo()),"buttons"===a&&this._createButtons(),"closeText"===a&&this.uiDialogTitlebarClose.button({label:""+b}),"draggable"===a&&((c=g.is(":data(ui-draggable)"))&&!b&&g.draggable("destroy"),!c&&b&&this._makeDraggable()),"position"===a&&this._position(),"resizable"===a&&((c=g.is(":data(ui-resizable)"))&&!b&&g.resizable("destroy"),c&&"string"===typeof b&&g.resizable("option","handles",b),!c&&!1!==b&&this._makeResizable()),"title"===a&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},
_size:function(){var a,b,c,g=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0});g.minWidth>g.width&&(g.width=g.minWidth);a=this.uiDialog.css({height:"auto",width:g.width}).outerHeight();b=Math.max(0,g.minHeight-a);c="number"===typeof g.maxHeight?Math.max(0,g.maxHeight-a):"none";"auto"===g.height?this.element.css({minHeight:b,maxHeight:c,height:"auto"}):this.element.height(Math.max(0,g.height-a));this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",
"minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var b=a(this);return a("<div>").css({position:"absolute",width:b.outerWidth(),height:b.outerHeight()}).appendTo(b.parent()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_createOverlay:function(){this.options.modal&&(a.ui.dialog.overlayInstances||this._delay(function(){a.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",
function(b){!a(b.target).closest(".ui-dialog").length&&!a(b.target).closest(".ui-datepicker").length&&(b.preventDefault(),a(".ui-dialog:visible:last .ui-dialog-content").data("ui-dialog")._focusTabbable())})}),this.overlay=a("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),a.ui.dialog.overlayInstances++)},_destroyOverlay:function(){this.options.modal&&this.overlay&&(a.ui.dialog.overlayInstances--,a.ui.dialog.overlayInstances||
this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}});a.ui.dialog.overlayInstances=0;!1!==a.uiBackCompat&&a.widget("opec.extendedDialog",a.opec.extendedDialog,{_position:function(){var b=this.options.position,c=[],e=[0,0],g;if(b){if("string"===typeof b||"object"===typeof b&&"0"in b)c=b.split?b.split(" "):[b[0],b[1]],1===c.length&&(c[1]=c[0]),a.each(["left","top"],function(a,b){+c[a]===c[a]&&(e[a]=c[a],c[a]=b)}),b={my:c[0]+(0>e[0]?e[0]:"+"+e[0])+" "+c[1]+(0>e[1]?e[1]:"+"+
e[1]),at:c.join(" ")};b=a.extend({},a.ui.dialog.prototype.options.position,b)}else b=a.ui.dialog.prototype.options.position;(g=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.position(b);g||this.uiDialog.hide()}})})(jQuery);var opec=opec||(opec={});opec.middlewarePath="/service";opec.wcsLocation=opec.middlewarePath+"/wcs2json/wcs?";opec.wfsLocation=opec.middlewarePath+"/wfs2json/wfs?";OpenLayers.ProxyHost=opec.middlewarePath+"/proxy?url=";opec.cache={};opec.cache.wmsLayers=[];opec.cache.wfsLayers=[];opec.layerStore=[];opec.microLayers=[];opec.selection={};opec.selection.layer=void 0;opec.selection.bbox=void 0;
var map,lonlat=new OpenLayers.Projection("EPSG:4326"),quickRegion=[["Choose a Region",-150,-90,150,90],["World View",-150,-90,150,90],["European Seas",-23.44,20.14,39.88,68.82],["Adriatic",11.83,39,20.67,45.8],["Baltic",9,51.08,30.5,67.62],["Biscay",-10,43,0,49],["Black Sea",27.3,38.5,42,49.8],["English Channel",-5,46.67,4.3,53.83],["Eastern Med.",20,29.35,36,41.65],["North Sea",-4.5,50.2,8.9,60.5],["Western Med.",-6,30.8,16.5,48.1],["Mediterranean",-6,29.35,36,48.1]];
opec.loadLayers=function(){var a=function(a,c,d){gritterErrorHandler({type:"master cache",request:a,errorType:c,exception:d,url:this.url})};opec.genericAsyc("./cache/mastercache.json",opec.initWMSlayers,a,"json",{});opec.genericAsyc("./cache/wfsMasterCache.json",opec.initWFSLayers,a,"json",{})};
opec.getFeature=function(a,b){var c=$.param({baseurl:a.url,request:"GetFeature",version:"1.1.0",featureID:a.WFSDatesToIDs[b],typeName:a.urlName});opec.genericAsyc(opec.wfsLocation+c,function(b){var b=b.output,c=b.position.split(" "),e=new OpenLayers.Geometry.Point(c[1],c[0]),b=new OpenLayers.Feature.Vector(e,{message:$("<div/>").html(b.content).html(),location:"Lon: "+c[1]+" Lat: "+c[0]});a.addFeatures(b)},function(a,b,c){gritterErrorHandler({type:"getFeature",request:a,errorType:b,exception:c,url:this.url})},
"json",{layer:a})};opec.genericAsyc=function(a,b,c,d,f){$.ajax({type:"GET",url:a,dataType:d,asyc:!0,cache:!1,success:function(a){b(a,f)},error:c})};
opec.MicroLayer=function(a,b,c,d,f,e,g,i,j,k,l){this.id=a;this.origName=a.replace("/","-");this.name=a.replace("/","-");this.urlName=a;this.displayTitle=b.replace(/_/g," ");this.title=b;this.productAbstract=c;this.firstDate=d;this.lastDate=f;this.serverName=e;this.wmsURL=g;this.wcsURL=i;this.sensorNameDisplay=j.replace(/\s+/g,"");this.sensorName=j.replace(/[\.,]+/g,"");this.exBoundingBox=k;this.providerTag=l};
opec.createBaseLayers=function(){function a(a,c,d){c=new OpenLayers.Layer.WMS(a,c,d,{projection:lonlat,wrapDateLine:!0,transitionEffect:"resize"});c.controlID="baseLayers";c.displayTitle=a;c.name=a;map.addLayer(c)}a("GEBCO","http://www.gebco.net/data_and_products/gebco_web_services/web_map_service/mapserv?",{layers:"gebco_08_grid"});a("Metacarta Basic","http://labs.metacarta.com/wms/vmap0",{layers:"basic"});a("Landsat","http://irs.gis-lab.info/?",{layers:"landsat"});a("Blue Marble","http://demonstrator.vegaspace.com/wmspub",
{layers:"BlueMarble"});map.numBaseLayers=map.getLayersBy("isBaseLayer",!0).length};
opec.createRefLayers=function(){function a(a,b){var c=new OpenLayers.Layer.Vector(a.name,{protocol:new OpenLayers.Protocol.HTTP({url:b,format:new OpenLayers.Format.GML}),strategies:[new OpenLayers.Strategy.Fixed],projection:lonlat,styleMap:a.style});c.controlID="refLayers";c.setVisibility(!1);c.id=a.name;c.displayTitle=a.displayTitle;c.title=a.displayTitle;map.addLayer(c);opec.leftPanel.addLayerToGroup(c,$("#refLayerGroup"))}opec.leftPanel.addGroupToPanel("refLayerGroup","Reference Layers",$("#opec-lPanel-reference"));
$.each(opec.cache.wfsLayers,function(b,c){if("undefined"!==typeof c.url&&"undefined"!==typeof c.serverName&&"undefined"!==typeof c.layers){var d=c.url;$.each(c.layers,function(b,c){if("undefined"!==typeof c.name&&"undefined"!==typeof c.options)if("undefined"!==typeof c.options.passthrough&&c.options.passthrough)c.style=new OpenLayers.StyleMap({strokeColor:"#00FF00",strokeOpacity:1,strokeWidth:3}),c.displayTitle=c.name,a(c,d);else{var e=new OpenLayers.Layer.Vector(c.name,{projection:lonlat,styleMap:new OpenLayers.StyleMap({"default":{strokeColor:"#00FF00",
strokeOpacity:1,strokeWidth:3,fillColor:"#FF5500",fillOpacity:0.5,pointRadius:6,pointerEvents:"visiblePainted",fontSize:"12px",fontFamily:"Courier New, monospace",fontWeight:"bold",labelOutlineColor:"white",labelOutlineWidth:3}}),eventListeners:{featureselected:function(a){var a=a.feature,b=new OpenLayers.Popup.FramedCloud("popup",OpenLayers.LonLat.fromString(a.geometry.toShortString()),null,a.attributes.message+"<br>"+a.attributes.location,null,!0,null);b.autoSize=!0;b.maxSize=new OpenLayers.Size(400,
500);b.fixedRelativePosition=!0;a.popup=b;map.addPopup(b)},featureunselected:function(a){a=a.feature;map.removePopup(a.popup);a.popup.destroy();a.popup=null}}},{typeName:c.name,format:"image/png",transparent:!0,exceptions:"XML",version:"1.0",layers:"1"}),f=opec.mapControls.selector.layers;if("undefined"===typeof f||null===f)f=[];f.push(e);opec.mapControls.selector.setLayer(f);if("undefined"!==typeof c.times&&c.times&&c.times.length){e.temporal=!0;for(var f=[],m={},n=0;n<c.times.length;n++){var p=
c.times[n];f.push(p.startdate);m[p.startdate]=p.id}e.DTCache=f;e.WFSDatesToIDs=m}e.urlName=c.name.replace("-",":");e.id=c.name;e.controlID="refLayers";e.setVisibility(!1);e.displayTitle=c.name;e.title=c.name;e.url=d;map.addLayer(e);opec.leftPanel.addLayerToGroup(e,$("#refLayerGroup"))}})}});for(var b=function(a){var b={"AMT 12 track":"blue","AMT 13 track":"aqua","AMT 14 track":"lime","AMT 15 track":"magenta","AMT 16 track":"red","AMT 17 track":"orange","AMT 19 track":"yellow"};if($.inArray(a,b))return b[a.attributes.Name]},
c=12;19>=c;c++)if(18!=c){var d=new OpenLayers.Style({strokeColor:"${colour}"},{context:{colour:b}}),d={name:"AMT"+c+"_Cruise_Track",displayTitle:"AMT"+c+" Cruise Track",style:new OpenLayers.StyleMap({"default":d})};a(d,"http://rsg.pml.ac.uk/geoserver/rsg/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=rsg:AMT"+c+"&outputFormat=GML2")}b=new OpenLayers.Layer.Vector("The_Black_Sea_KML",{projection:lonlat,strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:"black_sea.kml",
format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0})})});b.controlID="refLayers";b.selected=!0;b.id="The_Black_Sea_KML";b.displayTitle="The Black Sea (KML)";map.addLayer(b);opec.leftPanel.addLayerToGroup(b,$("#refLayerGroup"));map.numRefLayers=map.getLayersBy("controlID","refLayers").length};
opec.createOpLayers=function(){$.each(opec.cache.wmsLayers,function(a,b){if("undefined"!==typeof b.server&&"undefined"!==typeof b.wmsURL&&"undefined"!==typeof b.wcsURL&&"undefined"!==typeof b.serverName&&"undefined"!==typeof b.options){var c="undefined"!==typeof b.options.providerShortTag?b.options.providerShortTag:"",d=b.wmsURL,f=b.wcsURL,e=b.serverName;$.each(b.server,function(a,b){b.length&&$.each(b,function(b,i){if(i.Name&&""!==i.Name){var l=new opec.MicroLayer(i.Name,i.Title,i.Abstract,i.FirstDate,
i.LastDate,e,d,f,a,i.EX_GeographicBoundingBox,c);opec.checkNameUnique(l);$("#layers").multiselect("addItem",{text:c+": "+l.name,title:l.displayTitle,selected:opec.isSelected})}})})}})};opec.isSelected=function(a){if(map)return-1<$.inArray(a,map.sampleLayers)?!0:!1};opec.checkNameUnique=function(a,b){var c=null;"undefined"===typeof b||0===b?(c=a.name,b=0):c=a.name+b;c in opec.microLayers?opec.checkNameUnique(a,++b):0!==b&&(a.name+=b);opec.microLayers[a.providerTag+": "+a.name]=a};
opec.createOpLayer=function(a,b){var c=new OpenLayers.Layer.WMS(b.providerTag+": "+b.name,b.wmsURL,{layers:b.urlName,transparent:!0},{opacity:1,wrapDateLine:!0,transitionEffect:"resize"});$.each(a.Dimensions,function(a,b){if("time"==b.Name.toLowerCase()){c.temporal=!0;var e=b.Value.split(",");c.DTCache=e;c.firstDate=opec.utils.displayDateString(e[0]);c.lastDate=opec.utils.displayDateString(e[e.length-1])}else"elevation"==b.Name.toLowerCase()&&(c.elevation=!0,c.elevationCache=b.Value.split(","),c.mergeNewParams({elevation:b.Default}),
c.elevationDefault=b.Default,c.elevationUnits=b.Units)});c.id=b.id;c.origName=b.origName;c.urlName=b.urlName;c.displayTitle=b.displayTitle;c.title=b.title;c.productAbstract=b.productAbstract;c.displaySensorName=b.sensorNameDisplay;c.sensorName=b.sensorName;c.wcsURL=b.wcsURL;c.styles=a.Styles;c.exBoundingBox=b.exBoundingBox;c.boundingBox=a.BoundingBox;c.setVisibility(!1);c.selected=!1;opec.layerStore[c.name]=c;map.getMetadata(c)};
opec.addOpLayer=function(a){var b=opec.layerStore[a];"undefined"===typeof b||"null"==b?console.log("Error: Could not get a layer object"):(delete opec.layerStore[a],map.addLayer(b),map.setLayerIndex(b,map.numBaseLayers+map.numOpLayers),map.events.register("click",b,getFeatureInfo),opec.leftPanel.addLayerToGroup(b,opec.leftPanel.getFirstGroupFromPanel($("#opec-lPanel-operational"))),map.numOpLayers++)};
opec.removeOpLayer=function(a){opec.leftPanel.removeLayerFromGroup(a);map.removeLayer(a);map.events.unregister("click",a,getFeatureInfo);opec.layerStore[a.name]=a;map.numOpLayers--};opec.getLayerByID=function(a){return map.getLayersBy("id",a)[0]};opec.customPermalinkArgs=function(){OpenLayers.Control.Permalink.prototype.createParams.apply(this,arguments)};opec.checkLayerState=function(a){!a.visibility&&a.selected?$("#"+a.id).find('img[src="img/exclamation_small.png"]').show():$("#"+a.id).find('img[src="img/exclamation_small.png"]').hide()};
function mapInit(){map=new OpenLayers.Map("map",{projection:lonlat,displayProjection:lonlat,controls:[]});map.setupGlobe(map,"map",{is3D:!1,proxy:"/service/proxy?url="});opec.loadLayers();opec.createBaseLayers();opec.mapControls={zoomIn:new OpenLayers.Control.ZoomBox({out:!1,alwaysZoom:!0}),zoomOut:new OpenLayers.Control.ZoomBox({out:!0,alwaysZoom:!0}),pan:new OpenLayers.Control.Navigation,selector:new OpenLayers.Control.SelectFeature([],{hover:!1,autoActive:!0})};for(var a in opec.mapControls)map.addControl(opec.mapControls[a]);
map.getCenter()||map.zoomTo(3)}opec.initWMSlayers=function(a){opec.cache.wmsLayers=a;opec.createOpLayers()};opec.initWFSLayers=function(a){opec.cache.wfsLayers=a;opec.createRefLayers()};
function nonLayerDependent(){function a(){$("#quickRegion").val("Choose a Region")}function b(a,b){$(a).click(function(){$(b).extendedDialog("isOpen")?$(b).extendedDialog("close"):$(b).extendedDialog("open");return!1})}map.events.register("addlayer",map,function(){var a=map.getLayersBy("controlID","refLayers"),b=map.getLayersBy("controlID","poiLayer");$.each(a,function(a,b){map.setLayerIndex(b,map.numBaseLayers+map.numOpLayers+a+1)});$.each(b,function(a,b){map.setLayerIndex(b,map.layers.length-1)})});
map.events.register("moveend",map,a);for(var c=0;c<quickRegion.length;c++)$("#quickRegion").append('<option value="'+c+'">'+quickRegion[c][0]+"</option>");$("#quickRegion").change(function(){var b=$("#quickRegion").val(),b=(new OpenLayers.Bounds(quickRegion[b][1],quickRegion[b][2],quickRegion[b][3],quickRegion[b][4])).transform(map.displayProjection,map.projection);map.events.unregister("moveend",map,a);map.zoomToExtent(b);map.events.register("moveend",map,a)});opec.leftPanel.setup();opec.rightPanel.setup();
$(window).resize(function(a){a.target==window&&$(".ui-dialog-content").extendedDialog("option","position","center")});$("#layerAccordion").css("max-height",$(document).height()-300);$("#opec-lPanel-operational").css("max-height",$(document).height()-350);$("#opec-lPanel-reference").css("max-height",$(document).height()-350);$(window).resize(function(){$("#layerAccordion").css("max-height",$(window).height()-300);$("#opec-lPanel-operational").css("max-height",$(window).height()-350);$("#opec-lPanel-reference").css("max-height",
$(window).height()-350)});$("#opec-lPanel-content").on("mousedown","li",function(){var a=$(this);a.hasClass("notSelectable")||(a.children("input").first(),$(".opec-layer:visible").each(function(){$(this).removeClass("selectedLayer")}),a.addClass("selectedLayer"),$(this).trigger("selectedLayer"))});$("#opec-lPanel-operational, #opec-lPanel-reference").on("click",":checkbox",function(){var a=$(this).val(),a=opec.getLayerByID(a);if($(this).is(":checked"))if(a.selected=!0,a.temporal){map.selectDateTimeLayer(a,
$("#viewDate").datepicker("getDate"));var b=$.datepicker.parseDate("dd-mm-yy",a.firstDate),c=$.datepicker.parseDate("dd-mm-yy",a.lastDate);t1.addTimeBar(a.id,a.title,b,c,a.DTCache);map.refreshDateCache();$("#viewDate").datepicker("option","defaultDate",$.datepicker.parseDate("dd-mm-yy",a.lastDate))}else a.setVisibility(!0),opec.checkLayerState(a);else a.selected=!1,a.setVisibility(!1),opec.checkLayerState(a),a.temporal&&(t1.removeTimeBarByName(a.id),map.refreshDateCache())});map.events.register("mousemove",
map,function(a){(a=map.getLonLatFromPixel(a.xy))&&$("#latlng").text("Mouse Position: "+a.lon.toPrecision(4)+", "+a.lat.toPrecision(4))});$("#mapInfo-Projection").text("Map Projection: "+map.projection);$.each(map.layers,function(a,b){b.isBaseLayer&&$("#baseLayer").append('<option value="'+b.name+'">'+b.name+"</option>")});$("#viewDate").datepicker({showButtonPanel:!0,dateFormat:"dd-mm-yy",changeMonth:!0,changeYear:!0,beforeShowDay:function(a){return map.allowedDays(a)},onSelect:function(a,b){var c=
new Date(b.selectedYear,b.selectedMonth,b.selectedDay);t1.setDate(c);map.filterLayersByDate(c)}});$("#panZoom").buttonset();$("#pan").button({icons:{primary:"ui-icon-arrow-4-diag"}});$("#zoomIn").button({icons:{primary:"ui-icon-circle-plus"}});$("#zoomOut").button({icons:{primary:"ui-icon-circle-minus"}});opec.toggleControl=function(a){for(var b in opec.mapControls){var c=opec.mapControls[b];$(a).val()==b?($("#"+b).attr("checked",!0),c.activate(),"pan"==b&&opec.mapControls.selector.activate()):"selector"!=
b&&("pan"==b&&opec.mapControls.selector.deactivate(),$("#"+b).attr("checked",!1),c.deactivate())}$("#panZoom input:radio").button("refresh")};opec.toggleControl($("#panZoom input:radio"));$("#panZoom input:radio").click(function(){opec.toggleControl(this)});$("#opec-toolbar-actions").buttonset().children("button:first").button({label:"",icons:{primary:"ui-icon-opec-globe-info"}}).next().button({label:"",icons:{primary:"ui-icon-opec-globe-link"}}).next().next().button({label:"",icons:{primary:"ui-icon-opec-layers"}}).next().button({label:"",
icons:{primary:"ui-icon-opec-globe"}}).click(function(){map.globe.is3D?map.show2D():(map.show3D(),opec.gritter.showNotification("3DTutorial",null))}).next().next().button({label:"",icons:{primary:"ui-icon-opec-info"}});b("#infoToggleBtn","#info");b("#mapInfoToggleBtn","#mapInfo");b("#layerPreloader","#layerSelection");$("#shareMapToggleBtn").click(function(){$("#shareOptions").toggle()});$("#baseLayer").change(function(){map.setBaseLayer(opec.getLayerByID($("#baseLayer").val()))});opec.contextMenu.setup();
$.getJSON("timeline.json",function(a){t1=new opec.TimeLine("timeline",a)})}
function main(){opec.templates={};opec.templates.layer=Mustache.compile($("#opec-template-layer").text().trim());opec.templates.metadataWindow=Mustache.compile($("#opec-template-metadataWindow").text().trim());opec.templates.scalebarWindow=Mustache.compile($("#opec-template-scalebarWindow").text().trim());opec.templates.graphCreatorWindow=Mustache.compile($("#opec-template-graphCreatorWindow").text().trim());$("#info").extendedDialog({position:["left","bottom"],width:245,height:220,resizable:!1,showHelp:!1,
showMinimise:!0,dblclick:"collapse"});$("#mapInfo").extendedDialog({position:["center","center"],width:220,height:200,resizable:!0,autoOpen:!1,showHelp:!1,showMinimise:!0,dblclick:"collapse"});$("#layerSelection").extendedDialog({position:["center","center"],width:500,minWidth:500,height:400,minHeight:400,resizable:!0,autoOpen:!0,showHelp:!0,showMinimise:!0,dblclick:"collapse",restore:function(){$(this).trigger("resize")},help:function(){opec.gritter.showNotification("layerSelector",null)}});$("#layers").multiselect({selected:function(a,
b){if(b.option.text in opec.microLayers){var c=opec.microLayers[b.option.text];b.option.text in opec.layerStore?opec.addOpLayer(b.option.text):map.getLayerData(c.serverName+"_"+c.origName+".json",c)}else console.log("no layer data to use")},deselected:function(a,b){var c=opec.getLayerByID(b.option.text);c?opec.removeOpLayer(c):opec.layerStore[b.option.text]||console.log("no layer data to use")},addall:function(a,b){if(50<a.availableList.children("li.ui-element:visible").length){var c=$('<div id="warning" title="You sure about this?"><p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 50px 0;"></span>Adding lots of layers may cause the browser to slow down. Are you sure you want to proceed?</p></div>');
$(document.body).append(c);$("#warning").extendedDialog({position:["center","center"],width:300,height:200,resizable:!1,autoOpen:!0,modal:!0,buttons:{"Add Layers":function(){$(this).extendedDialog("close");b(a)},"Stop Adding Layers":function(){$(this).extendedDialog("close")}},close:function(){$("#warning").remove()}})}else b(a)}});$(document.body).append('<div id="this-Is-A-Prototype" title="This is a prototype, be nice!"><p>This is a prototype version of the OPEC (Operational Ecology) Marine Ecosystem Forecasting portal and therefore may be unstable. If you find any bugs or wish to provide feedback you can find more info <a href="http://trac.marineopec.eu/wiki" target="_blank">here</a>.</p></div>');
$("#this-Is-A-Prototype").extendedDialog({position:["center","center"],width:300,height:230,resizable:!1,autoOpen:!0,modal:!0,showHelp:!1,buttons:{Ok:function(){$(this).extendedDialog("close")}},close:function(){$("#this-Is-A-Prototype").remove()}});opec.gritter.setup();mapInit();nonLayerDependent()}
function getFeatureInfo(a){if(this.visibility&&map.getControlsByClass("OpenLayers.Control.Navigation")[0].active){var b=new OpenLayers.Pixel(a.xy.x,a.xy.y),c=map.getLonLatFromPixel(b);if(!this.isBaseLayer){if("undefined"!==typeof this.options.clickable&&!this.options.clickable)return null;var d=new OpenLayers.Pixel(b.x+10,b.y+10),f=new OpenLayers.Pixel(b.x-10,b.y-10);(b=this.options.bbox)&&0<b.length&&(b=b[0]);var e=new OpenLayers.Bounds;if(b)if(b.lowercorner&&b.uppercorner){var g=b.lowercorner.split(" "),
i=b.uppercorner.split(" ");e.extend(new OpenLayers.LonLat(g[0],g[1]));e.extend(new OpenLayers.LonLat(i[0],i[1]))}else b.maxx&&(b.maxy&&b.minx&&b.miny)&&(e.extend(new OpenLayers.LonLat(b.minx,b.miny)),e.extend(new OpenLayers.LonLat(b.maxx,b.maxy)));g=new OpenLayers.Bounds;g.extend(map.getLonLatFromPixel(d));g.extend(map.getLonLatFromPixel(f));f=map.getLonLatFromPixel(f);d=map.getLonLatFromPixel(d);if(g.intersectsBounds(e)||!b){var j=new OpenLayers.Popup("temp",c,new OpenLayers.Size(100,50),"Loading...",
!0,null);j.autoSize=!0;map.addPopup(j);b=d.lat+","+f.lon+","+f.lat+","+d.lon;b=d="";this.url.contains("1.0RC3")?(d="&X=",b="&Y="):(d="&I=",b="&J=");$.ajax({type:"GET",url:OpenLayers.ProxyHost+this.url+encodeURIComponent("request=GetFeatureInfo&service=wms&layers="+this.urlName+"&QUERY_LAYERS="+this.urlName+"&version=1.1.1&bbox="+map.getExtent().toBBOX()+"&time="+this.params.TIME+"&elevation="+this.params.ELEVATION+d+a.xy.x+b+a.xy.y+"&SRS=EPSG:4326&INFO_FORMAT=text/xml&WIDTH="+map.size.w+"&HEIGHT="+
map.size.h),dataType:"xml",asyc:!0,success:function(a){console.log(a);var b=parseFloat(getElementValue(a,"longitude")),d=parseFloat(getElementValue(a,"latitude")),a=parseFloat(getElementValue(a,"value")),e="";b&&(d&&a)&&(a=a.toPrecision(4),e="<b>Lon:</b> "+b.toFixed(6)+"<br /><b>Lat:</b> "+d.toFixed(6)+"<br /><b>Value:</b> "+a+"<br />");map.removePopup(j);b=new OpenLayers.Popup("id",c,new OpenLayers.Size(100,50),e,!0,null);b.autoSize=!0;map.addPopup(b)},error:function(a,b,c){gritterErrorHandler({type:"master cache",
request:a,errorType:b,exception:c,url:this.url})}})}}}}function getElementValue(a,b){var c=a.getElementsByTagName(b);return!c||!c[0]||!c[0].firstChild?null:c[0].firstChild.nodeValue}function setColourScaleMin(){}function setColourScaleMax(){}
function addDThreeGraph(){var a=d3.time.format("%Y-%m-%dT%H:%M:%S").parse,b=d3.time.scale().range([0,830]),c=d3.scale.linear().range([450,0]),d=d3.scale.category10(),f=d3.svg.axis().scale(b).orient("bottom"),e=d3.svg.axis().scale(c).orient("left"),g=d3.svg.line().interpolate("basis").x(function(a){return b(a.date)}).y(function(a){return c(a.temperature)}),i=d3.select("#dThree").append("svg").attr("width",960).attr("height",500).append("g").attr("transform","translate(50,20)");d3.tsv("data.tsv",function(j,
k){d.domain(d3.keys(k[0]).filter(function(a){return"date"!==a}));k.forEach(function(b){b.date=a(b.date)});var l=d.domain().map(function(a){return{name:a,values:k.map(function(b){return{date:b.date,temperature:+b[a]}})}});b.domain(d3.extent(k,function(a){return a.date}));c.domain([d3.min(l,function(a){return d3.min(a.values,function(a){return a.temperature})}),d3.max(l,function(a){return d3.max(a.values,function(a){return a.temperature})})]);i.append("linearGradient").attr("id","temperature-gradient").attr("gradientUnits",
"userSpaceOnUse").attr("x1",0).attr("y1",c(10)).attr("x2",0).attr("y2",c(20)).selectAll("stop").data([{offset:"0%",color:"steelblue"},{offset:"50%",color:"gray"},{offset:"100%",color:"red"}]).enter().append("stop").attr("offset",function(a){return a.offset}).attr("stop-color",function(a){return a.color});i.append("g").attr("class","x axis").attr("transform","translate(0,450)").call(f);i.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",
".71em").style("text-anchor","end").text("Temperature (\u00baC)");l=i.selectAll(".city").data(l).enter().append("g").attr("class","city");l.append("path").attr("class","line").attr("d",function(a){return g(a.values)}).style("stroke",function(a){return d(a.name)});l.append("text").datum(function(a){return{name:a.name,value:a.values[a.values.length-1]}}).attr("transform",function(a){return"translate("+b(a.value.date)+","+c(a.value.temperature)+")"}).attr("x",3).attr("dy",".35em").text(function(a){return a.name})})}
;opec.window={};opec.window._openWindows={};opec.window._windowTypes=[];opec.window.addWindow=function(a){opec.window._windowTypes[a.name]=a};opec.window.createWindow=function(a,b,c){-1!==$.inArray(a,opec.window._windowTypes)&&(a=opec.window._windowTypes[a].create(a,b,c),opec.window._openWindows[b]=a)};opec.window.removeWindow=function(a){if("undefined"!==typeof opec.window._openWindows){var b=opec.window._openWindows[a];"undefined"!==typeof b&&(b.destroy(),delete opec.window._openWindows[a])}};
opec.window.getWindow=function(){};opec.window.createScalebar=function(a){var b=opec.getLayerByID(a.attr("id")),a=getScalebarDetails(b);$("#scalebar-"+b.id).length&&$("#scalebar-"+b.id).extendedDialog("close");a={name:b.id,displayTitle:b.displayTitle,url:a.url};$(document.body).append(opec.templates.scalebarWindow(a));"undefined"!==typeof b.minScaleVal&&"undefined"!==typeof b.maxScaleVal?($("#"+b.id+"-max").val(b.maxScaleVal),$("#"+b.id+"-min").val(b.minScaleVal)):($("#"+b.id+"-max").val="",$("#"+b.id+"-min").val="");$("#scalebar-"+
b.id).extendedDialog({position:["center","center"],width:310,resizable:!1,autoOpen:!1,showHelp:!0,showMinimise:!0,dblclick:"collapse",close:function(){$("#scalebar-"+b.id).remove()},restore:function(){$(this).trigger("resize")},help:function(){opec.gritter.showNotification("scalebarTutorial",null)}});$("#"+b.id+"-log").on("click",":checkbox",function(){if(!b.log||!$(this).is(":checked"))(!1!==b.log||$(this).is(":checked"))&&validateScale(b,null,null)});$("#"+b.id+"-reset").on("click",'[type="button"]',
function(){validateScale(b,b.origMinScaleVal,b.origMaxScaleVal,!0)});$("#"+b.id+"-scale").on("click",'[type="button"]',function(){var a=getScaleRange(b.minScaleVal,b.maxScaleVal);$("#"+b.id+"-range-slider").slider("option","min",a.min);$("#"+b.id+"-range-slider").slider("option","max",a.max);validateScale(b,b.minScaleVal,b.maxScaleVal)});$("#"+b.id+"-max").focusout(function(){var a=parseFloat($(this).val());a!=b.maxScaleVal&&validateScale(b,null,a)});$("#"+b.id+"-min").focusout(function(){var a=parseFloat($(this).val());
a!=b.minScaleVal&&validateScale(b,a,null)});a=getScaleRange(b.minScaleVal,b.maxScaleVal);$("#"+b.id+"-range-slider").slider({orientation:"vertical",range:!0,values:[b.minScaleVal,b.maxScaleVal],max:a.max,min:a.min,step:1E-8,change:function(){($(this).slider("values",0)!=b.minScaleVal||$(this).slider("values",1)!=b.maxScaleVal)&&validateScale(b,$(this).slider("values",0),$(this).slider("values",1))}});$("#"+b.id+"-range-slider").css({height:256,margin:"5px 0px 0px 10px"});$("#scalebar-"+b.id).extendedDialog("open")};
function updateScalebar(a){if($("#scalebar-"+a.id).length){var b=getScalebarDetails(a);$("#scalebar-"+a.id+"> img").attr("src",b.url);a.mergeNewParams({colorscalerange:a.minScaleVal+","+a.maxScaleVal,logscale:a.log});console.info("url: "+b.url)}}
function getScalebarDetails(a){var b=null,c=110,d=256;$.each(a.styles,function(f,e){if(e.Name==a.params.STYLES&&null===b)return b=e.LegendURL+createGetLegendURL(a,!0),c=parseInt(e.Width,10),d=parseInt(e.Height,10),!1});null===b&&(b=createGetLegendURL(a,!1));return{url:b,width:c,height:d}}function getScaleRange(a,b){return{max:b+Math.abs(25*(b/100)),min:a-Math.abs(25*(b/100))}}
function validateScale(a,b,c,d){if(null===b||"undefined"===typeof b)b=a.minScaleVal;if(null===c||"undefined"===typeof c)c=a.maxScaleVal;if(null===d||"undefined"===typeof d)d=!1;b=parseFloat(b);c=parseFloat(c);if(isNaN(b))alert("Scale limits must be set to valid numbers"),$("#"+a.id+"-min").val(a.minScaleVal),$("#"+a.id+"-range-slider").slider("values",0,a.minScaleVal);else if(isNaN(c))alert("Scale limits must be set to valid numbers"),$("#"+a.id+"-max").val(a.maxScaleVal),$("#"+a.id+"-range-slider").slider("values",
1,a.maxScaleVal);else if(b>c)alert("Minimum scale value must be less than the maximum"),$("#"+a.id+"-min").val(a.minScaleVal),$("#"+a.id+"-max").val(a.maxScaleVal);else if(0>=b&&$("#"+a.id+"-log").children('[type="checkbox"]').first().is(":checked"))alert("Cannot use a logarithmic scale with negative or zero values"),$("#"+a.id+"-log").children('[type="checkbox"]').attr("checked",!1),$("#"+a.id+"-range-slider").slider("values",0,a.minScaleVal);else{$("#"+a.id+"-min").val(b);$("#"+a.id+"-max").val(c);
if(b<$("#"+a.id+"-range-slider").slider("option","min")||c>$("#"+a.id+"-range-slider").slider("option","max")||!0===d)d=getScaleRange(b,c),$("#"+a.id+"-range-slider").slider("option","min",d.min),$("#"+a.id+"-range-slider").slider("option","max",d.max),console.log("scale changed");a.minScaleVal=b;a.maxScaleVal=c;a.log=$("#"+a.id+"-log").children('[type="checkbox"]').first().is(":checked")?!0:!1;$("#"+a.id+"-range-slider").slider("values",0,b);$("#"+a.id+"-range-slider").slider("values",1,c);updateScalebar(a)}}
function createGetLegendURL(a,b){return b?"&COLORSCALERANGE="+a.minScaleVal+","+a.maxScaleVal+"&logscale="+a.log:a.url+"REQUEST=GetLegendGraphic&LAYER="+a.urlName+"&COLORSCALERANGE="+a.minScaleVal+","+a.maxScaleVal+"&logscale="+a.log};opec.window.createGraphCreator=function(){var a=$("#graphCreator");a.length&&a.extendedDialog("close");$("#opec-graphing").append(opec.templates.graphCreatorWindow({advanced:!0}));var a=$("#graphCreator"),b=a.find("#graphcreator-generate").first();$("#graphcreator-time, #graphcreator-time2").datepicker({showButtonPanel:!0,dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0});var c=$("#viewDate").datepicker("getDate");""!==c&&($("#graphcreator-time").datepicker("setDate",c),$("#graphcreator-time2").datepicker("setDate",
c));c=opec.getLayerByID($(".selectedLayer:visible").attr("id"));$("#graphcreator-baseurl").val(c.wcsURL);$("#graphcreator-coverage").val(c.origName);$(".lPanel").bind("selectedLayer",function(){var a=opec.getLayerByID($(".selectedLayer:visible").attr("id"));$("#graphcreator-baseurl").val(a.wcsURL);$("#graphcreator-coverage").val(a.origName)});b.find('img[src="img/ajax-loader.gif"]').hide();$("#graphcreator-bbox").click(function(){opec.gritter.showNotification("bbox",null)});$(".ui-control-header").click(function(){$(this).toggleClass("ui-control-header-active").find("> .ui-icon").toggleClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").end().next().toggleClass("ui-control-content-active").slideToggle();
return!1});$("#graphcreator-coverage-button").click(function(){$.each($(".sensor-accordion").children("li").children(":checkbox").get().reverse(),function(){if($(this).is(":checked")){var a=$(this).parent("li").attr("id"),a=opec.getLayerByID(a);$("#graphcreator-coverage").val(a.origName);$("#graphcreator-baseurl").val(a.wcsURL)}});return!1});a.unbind(".loadGraph").bind("ajaxStart.loadGraph",function(){$(this).find('img[src="img/ajax-loader.gif"]').show()}).bind("ajaxStop.loadGraph",function(){$(this).find('img[src="img/ajax-loader.gif"]').hide()});
$("#graphcreator-barwidth-button").click(function(){return!1});$("#histogram-inputs-header").trigger("click");$("#advanced-inputs-header").trigger("click");$("#graph-format-header").trigger("click");b.on("click",":button",function(){var a=$("#graphcreator-time").val();""!==$("#graphcreator-time2").val()&&(a+="/"+$("#graphcreator-time2").val());var b=null,c=null;"hovmollerLon"==$("#graphcreator-type").val()?(b="Lon",c="Time"):"hovmollerLat"==$("#graphcreator-type").val()&&(b="Time",c="Lat");a={baseurl:$("#graphcreator-baseurl").val(),
coverage:$("#graphcreator-coverage").val(),type:$("#graphcreator-type").val(),bins:$("#graphcreator-bins").val(),time:a,bbox:$("#graphcreator-bbox").val(),graphXAxis:b,graphYAxis:c,graphZAxis:$("#graphcreator-coverage").val()};a=$.param(a);$.ajax({type:"GET",url:opec.wcsLocation+a,dataType:"json",asyc:!0,success:function(a){opec.graphs.create(a)},error:function(a,b,c){gritterErrorHandler({type:"wcs data",request:a,errorType:b,exception:c,url:this.url})}})})};
var graphCreator={name:"graphCreator",create:function(a,b,c){var d={uid:b,windowType:a,$instance:null,template:c.template,templateData:c.templateData,show:function(){this.$instance.length&&this.$instance.extendedDialog("open")},hide:function(){this.$instance.length&&this.$instance.extendedDialog("close")},destroy:this.destroy()},a=$("#"+d.uid);a.length&&a.extendedDialog("close");$(document.body).append(d.template(d.templateData));d.$instance=$("#"+d.uid);d.$instance.extendedDialog({position:["center",
"center"],width:340,resizable:!1,autoOpen:!1,close:function(){$("#"+d.uid).remove()},showHelp:!0,showMinimise:!0,dblclick:"collapse",help:function(){opec.gritter.showNotification("graphCreatorTutorial",null)}});this.logic();graphCreator.extendedDialog("open");return d},logic:function(){var a=window.$instance.find("#graphcreator-generate").first();$("#graphcreator-time, #graphcreator-time2").datepicker({showButtonPanel:!0,dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0});var b=opec.getLayerByID($(".selectedLayer:visible").attr("id"));
$("#graphcreator-baseurl").val(b.wcsURL);$("#graphcreator-coverage").val(b.origName);$(".lPanel").bind("selectedLayer",function(){var a=opec.getLayerByID($(".selectedLayer:visible").attr("id"));$("#graphcreator-baseurl").val(a.wcsURL);$("#graphcreator-coverage").val(a.origName)});a.find('img[src="img/ajax-loader.gif"]').hide();$("#graphcreator-bbox").click(function(){opec.gritter.showNotification("bbox",null)});$(".ui-control-header").click(function(){$(this).toggleClass("ui-control-header-active").find("> .ui-icon").toggleClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").end().next().toggleClass("ui-control-content-active").slideToggle();
return!1});$("#graphcreator-coverage-button").click(function(){$.each($(".sensor-accordion").children("li").children(":checkbox").get().reverse(),function(){if($(this).is(":checked")){var a=$(this).parent("li").attr("id");$("#graphcreator-coverage").val(a);a=opec.getLayerByID(a);$("#graphcreator-baseurl").val(a.wcsURL)}});return!1});graphCreator.unbind(".loadGraph").bind("ajaxStart.loadGraph",function(){$(this).find('img[src="img/ajax-loader.gif"]').show()}).bind("ajaxStop.loadGraph",function(){$(this).find('img[src="img/ajax-loader.gif"]').hide()});
$("#graphcreator-barwidth-button").click(function(){return!1});$("#histogram-inputs-header").trigger("click");$("#advanced-inputs-header").trigger("click");$("#graph-format-header").trigger("click");a.on("click",":button",function(){var a=$("#graphcreator-time").val();""!==$("#graphcreator-time2").val()&&(a+="/"+$("#graphcreator-time2").val());var b=null,f=null;"hovmollerLon"==$("#graphcreator-type").val()?(b="Lon",f="Time"):"hovmollerLat"==$("#graphcreator-type").val()&&(b="Time",f="Lat");a={baseurl:$("#graphcreator-baseurl").val(),
coverage:$("#graphcreator-coverage").val(),type:$("#graphcreator-type").val(),bins:$("#graphcreator-bins").val(),time:a,bbox:$("#graphcreator-bbox").val(),graphXAxis:b,graphYAxis:f,graphZAxis:$("#graphcreator-coverage").val()};a=$.param(a);$.ajax({type:"GET",url:opec.wcsLocation+a,dataType:"json",asyc:!0,success:function(a){if(""!==a.error)opec.gritter.showNotification("graphError",{error:a.error});else if("basic"==a.type){(new Date(a.output.global.time)).getTime();var b=[],c=[],d=[],f=[],l=[];$.each(a.output.data,
function(a,e){b.push([(new Date(a)).getTime(),e.std]);c.push([(new Date(a)).getTime(),e.max]);d.push([(new Date(a)).getTime(),e.min]);f.push([(new Date(a)).getTime(),e.median]);l.push([(new Date(a)).getTime(),e.mean])});var m={id:"wcsgraph"+Date.now(),title:"WCS Test Graph",data:[{data:b.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},label:"STD"},{data:c.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},label:"max"},{data:d.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},
label:"min"},{data:f.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},label:"median"},{data:l.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},label:"mean"}],options:basicTimeOptions(a.output.units),selectable:!0,selectSeries:!0};createGraph(m)}else"histogram"==a.type?(a=a.output.histogram.Numbers,m=Math.abs(a[a.length-1][0]-a[0][0])/a.length,m={id:"wcsgraph"+Date.now(),title:"WCS Test Graph",data:[a],options:barOptions(m),selectable:!1},createGraph(m)):"hovm\u00f6llerLon"==
a.type&&((new Date(a.output.global.time)).getTime(),m={id:"wcsgraph"+Date.now(),title:"WCS Hovm\u00f6ller Test Graph"},hovmoller(m,a.output))},error:function(a,b,c){gritterErrorHandler({type:"wcs data",request:a,errorType:b,exception:c,url:this.url})}})})},destroy:function(){}};opec.window.addWindow(graphCreator);opec.window.createMetadata=function(a){if(null!==a){$("#metadata-"+a.id).length&&$("#metadata-"+a.id).extendedDialog("close");var b={id:a.id,displayTitle:a.displayTitle,northBoundLat:a.exBoundingBox.NorthBoundLatitude,eastBoundLon:a.exBoundingBox.EastBoundLongitude,southBoundLat:a.exBoundingBox.SouthBoundLatitude,westBoundLon:a.exBoundingBox.WestBoundLongitude,addDateRange:a.temporal,productAbstract:a.productAbstract,firstDate:a.firstDate,lastDate:a.lastDate};$(document.body).append(opec.templates.metadataWindow(b));
$("#metadata-"+a.id).extendedDialog({position:["center","center"],width:400,height:250,resizable:!0,autoOpen:!1,close:function(){$("#metadata-"+a.id).remove()},showHelp:!1,showMinimise:!0,dblclick:"collapse"});$("#metadata-"+a.id).extendedDialog("open")}};opec.gritter={};opec.gritter._notifications=[];opec.gritter.tutUID=null;opec.gritter.setup=function(){$.extend($.gritter.options,{position:"bottom-right",fade_in_speed:"medium",fade_out_speed:800,time:6E3});createHelpMessages();createWelcomeMessage();opec.gritter.gritterLayerHelper()};opec.gritter.addNotification=function(a,b){opec.gritter._notifications[a]=b};
opec.gritter.showNotification=function(a,b){var c=opec.gritter._notifications[a];"undefined"===typeof c.title&&(c.title=function(){return"Sorry, No Help Message Found"});"undefined"===typeof c.text&&(c.text=function(){return"Sorry, we could not find a help message for your problem. Please refer to any help documentation you have."});"undefined"===typeof c.afterOpen&&(c.afterOpen=function(){});"undefined"===typeof c.max&&(c.max=1);return $.gritter.add({title:c.title(b),text:c.text(b),after_open:function(){c.afterOpen(b)},
class_name:"gritter-light",sticky:!0,group:a,max:c.max})};opec.gritter.hideNotification=function(a){"undefined"!==typeof a.uid&&$.gritter.remove(a.uid,{fade:!1,speed:"fast"})};function createWelcomeMessage(){opec.gritter.tutUID=opec.gritter.showNotification("welcomeTutorial",null)}
function gritterErrorHandler(a){400==a.request.status?opec.gritter.showNotification("error400",a):500==a.request.status?opec.gritter.showNotification("error500",a):502==a.request.status?opec.gritter.showNotification("error502"):"parsererror"==a.errorType?opec.gritter.showNotification("errorParserError",a):a.layer?$.gritter.add({title:a.errorType.toUpperCase()+": "+a.request.status+" ("+a.exception+")",text:"Could not get the "+a.type+" from the server for "+a.layer.name+". Try refreshing the page",
class_name:"gritter-light",sticky:!0}):$.gritter.add({title:a.errorType.toUpperCase()+": "+a.request.status+" ("+a.exception+")",text:"Could not get the "+a.type+" from the server. Try refreshing the page",class_name:"gritter-light",sticky:!0})}
opec.gritter.gritterLayerHelper=function(){$(document).on("click",'img[src="img/exclamation_small.png"]',function(){var a=$(this).parent().parent().attr("id"),a=opec.getLayerByID(a),b="none";if(a.temporal){var c=$("#viewDate").datepicker("getDate");null!==c?(c=opec.utils.ISODateString(new Date(c.selectedYear,c.selectedMonth,c.selectedDay)),null===a.matchDate(c)&&(b="dateNotInRange")):null===c&&(b="noDate")}opec.gritter.showNotification(b,{layer:a});return!1})};
function createHelpMessages(){opec.gritter._notifications.welcomeTutorial={title:function(){return"Welcome to the Opec Portal"},text:function(){return'<p>It\'s great to have you here! First thing you need to do is decide which layers you want to use. You can do that from the <a id="wtHelp-layerSelectionPanel" href="#">layer selection panel</a>.</p><br> <p>If you have any trouble, you can always just hit the <a id="wtHelp-questionMark" href="#">question mark</a> at the top of most windows.</p><br><p>When you are ready for the next step just click <a id="wtHelp-next" href="#">next</a>.</p>'},
afterOpen:function(){$("#wtHelp-layerSelectionPanel").click(function(){$("#layerSelection").extendedDialog("isOpen")?$("#layerSelection").parent("div").fadeTo("slow",0.3,function(){$(this).fadeTo("slow",1)}):$("#layerPreloader").fadeTo("slow",0.3,function(){$(this).fadeTo("slow",1)});return!1});$("#wtHelp-questionMark").click(function(){$(".ui-dialog-titlebar-help:visible").effect("highlight",{},3E3);return!1});$("#wtHelp-next").click(function(){opec.gritter.hideNotification({uid:opec.gritter.tutUID});
opec.gritter.tutUID=opec.gritter.showNotification("layerTutorial",null);return!1})},max:1};opec.gritter._notifications.layerTutorial={title:function(){return"Viewing Layers"},text:function(){return'<p>To view the layers you just selected, you need to use the <a id="ltHelp-layersPanel" href="#">layers panel</a>.<p><br><p>If you want to see a layer displayed on the map you need to select it\'s checkbox and then select a date (We will cover dates next).<p><br><p>When you are done with a layer just uncheck it. You can also right click on layers for further options.<p><br><p>When you are ready for the next step just click <a id="wtHelp-next" href="#">next</a>.<p>'},
afterOpen:function(){$("#ltHelp-layersPanel").click(function(){$(".triggerL").trigger("click");return!1});$("#wtHelp-next").click(function(){opec.gritter.hideNotification({uid:opec.gritter.tutUID});opec.gritter.tutUID=opec.gritter.showNotification("dateTutorial",null);return!1})},max:1};opec.gritter._notifications.dateTutorial={title:function(){return"Selecting Dates"},text:function(){return'To select a date to be used by temporal layers, click on the <a id="dtDatepickerBtn" href="#">datepicker</a> at the top of the screen. Then use the left and right arrows to change the month or use the dropdown boxes. You can also type a date into the textbox. <a id="dtNext" href="#">Next</a>.'},
afterOpen:function(){$("#dtNext").click(function(){opec.gritter.hideNotification({uid:opec.gritter.tutUID});opec.gritter.tutUID=opec.gritter.showNotification("tbdTutorial",null);return!1});$("#dtDatepickerBtn").click(function(){$("#viewDate").datepicker("show").datepicker("show").effect("highlight",{},3E3);return!1})},max:1};opec.gritter._notifications.tbdTutorial={title:function(){return"To Be Continued"},text:function(){return'Be sure to provide any feedback about these tutorials <a id="give-some-feedback" href="http://trac.marineopec.eu/wiki" target="_blank">here</a>. Are they useful? Easy to follow? Too long? Too short?'},
max:1};opec.gritter._notifications.noDate={title:function(){return"You need to select a date"},text:function(){return'This layer is a temporal layer and requires a date to be selected. To select a date use the <a id="datepickerBtn" href="#">datepicker</a> at the top of the screen.'},afterOpen:function(a){$("#datepickerBtn").click(function(){var b=$.datepicker.parseDate("dd-mm-yy",a.layer.lastDate);$("#viewDate").datepicker("option","defaultDate",b).datepicker("show").effect("highlight",{},3E3);return!1})},
max:1};opec.gritter._notifications.dateNotInRange={title:function(){return"Select another date"},text:function(a){return"The date you have selected is not avaliable for this layer. This layer supports dates between "+a.layer.firstDate+" and "+a.layer.lastDate+". Try selecting another date that all layers share."},max:3};opec.gritter._notifications.layerSelector={title:function(){return"Layer Selection Tutorial"},text:function(){return'The layer selector is made up of two parts. The <a id="help-selectedLayers" href="#">selected layers</a> panel and the <a id="help-availableLayers" href="#">available layers</a> panel. To select a layer, you can click the plus sign at the end of a layer or drag a layer from one side to the other. To deselect a layer you can click the minus sign at the end of the layer or again drag from one side to the other.'},
afterOpen:function(){$("#help-selectedLayers").click(function(){$("#layers .selected").fadeTo("slow",0.3,function(){$(this).fadeTo("slow",1)});return!1});$("#help-availableLayers").click(function(){$("#layers .available").fadeTo("slow",0.3,function(){$(this).fadeTo("slow",1)});return!1})},max:1};opec.gritter._notifications.graphCreatorTutorial={title:function(){return"Lets Create A Graph!"},text:function(){return"To create a graph we need three things. The wcs server to query (Base URL), the coverage to get and the type of graph we want to create. You can also provide a bbox and/or a time range. If you're creating a histogram you can also provide some bins, but if you don't some will be created for you."},
max:1};opec.gritter._notifications.scalebarTutorial={title:function(){return"Scalebar Tutorial"},text:function(){return"The scalebar allows you to change the range of values used using the slider or if you prefer the min and max boxes. If you need to increase the range just enter a bigger number in any of the text boxes."},max:1};opec.gritter._notifications.bbox={title:function(){return"Select a bounding box"},text:function(){return'Now select a bouding box on the map using the <a id="rect-bbox" href="#">rectangular bounding box drawing tool</a>.'},
afterOpen:function(){$("#rect-bbox").click(function(){$("#box").next().effect("highlight",{},3E3);return!1})},max:1};opec.gritter._notifications.badRequestHelp={title:function(){return"Dealing With Bad Requests"},text:function(){return"Some things to try when dealing with bad requests:<ol><li>Check the parameters are valid. BaseURL, Coverage, Type, etc..</li><li>Using a Bbox? Is it inside the area covered by the layer? Have you tried it in a different spot?</li><li>Using a date? Is it correctly formated? Does the layer have data for that time?</li><li>Is the baseURL the correct one for that layer?</li><li>View the query yourself in a browser, it may have more information as to what is wrong.</li></ol>"},
max:1};opec.gritter._notifications["3DTutorial"]={title:function(){return"Welcome to 3D mode!"},text:function(){return'<p>Things are a little different here. Left click and drag will rotate the planet. Right click and drag up or down will zoom in or out (You can use the mouse wheel too!). Middle click and drag will rotate the camera.</p><br> <p><a id="tDT-Not-Working" href="#">Not working?</a></p>'},afterOpen:function(){$("#tDT-Not-Working").click(function(){opec.gritter.showNotification("3DNotWorking",
null);return!1})},max:1};opec.gritter._notifications["3DNotWorking"]={title:function(){return"Try this..."},text:function(){return'Check that your browser and hardware support webGL <a id="tDNW-webglCheck" href="http://get.webgl.org/" target="_blank">here</a> .'},max:1};opec.gritter._notifications.error400={title:function(){return"Sorry what was that? Could you say that again?"},text:function(a){return'We had a little trouble understanding what you wanted as a bad request was made. You can view the request for yourself <a id="url400" href="'+
a.url+'" target="_blank">here</a>. Make sure you have entered all the required parameters (base URL, coverage and type) and that each of them is valid before trying again. If you still have trouble it may be that there is no data available for your selection. Do you need some further help? <a id="error400-next" href="#">Yes</a>'},afterOpen:function(){$("#error400-next").click(function(){opec.gritter.showNotification("badRequestHelp",null);return!1})},max:1};opec.gritter._notifications.error500={title:function(){return"We're Sorry...Something Went Wrong"},
text:function(a){return'The server had some trouble while performing your query. You can view the query <a id="url500" href="'+a.url+'" target="_blank">here</a>. This is a server-side error meaning the problem is not with your computer or Internet connection, but with the server. We apologise for the inconvenience. While we fix this maybe you would like to try a different query?'},max:1};opec.gritter._notifications.error502={title:function(){return"Well That Wasn't Supposed To Happen"},text:function(){return'Sorry, looks like we had some trouble talking to one of our servers. It was a "Bad Gateway", if that means anything to anyone? This in most cases is a temporary error, so you can keep trying or come back and try later. The problem could be on your end, so you may need to contact your local administrator or if at home, just check that other sites work.'},
max:1};opec.gritter._notifications.errorParserError={title:function(){return"Parse Error: Unexpected character"},text:function(a){return'An unexpected character was received from "<a id="urlParserError" href="'+a.url+'" target="_blank">this</a>" address.'},max:1};opec.gritter._notifications.graphError={title:function(){return"Sorry, we failed to create a graph"},text:function(a){return'The server informed us that it failed to make a graph for your selection with the message "'+a.error+'".'}}};opec.graphs={};
opec.graphs.create=function(a){if(""!==a.error)opec.gritter.showNotification("graphError",{error:a.error});else if("basic"==a.type){(new Date(a.output.global.time)).getTime();var b=[],c=[],d=[],f=[],e=[];$.each(a.output.data,function(a,g){b.push([(new Date(a)).getTime(),g.std]);c.push([(new Date(a)).getTime(),g.max]);d.push([(new Date(a)).getTime(),g.min]);f.push([(new Date(a)).getTime(),g.median]);e.push([(new Date(a)).getTime(),g.mean])});a={id:"wcsgraph"+Date.now(),title:"WCS Test Graph",data:[{data:b.sort(opec.utils.sortDates),
lines:{show:!0},points:{show:!0},label:"STD"},{data:c.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},label:"max"},{data:d.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},label:"min"},{data:f.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},label:"median"},{data:e.sort(opec.utils.sortDates),lines:{show:!0},points:{show:!0},label:"mean"}],options:basicTimeOptions(a.output.units),selectable:!0,selectSeries:!0};createGraph(a)}else if("histogram"==a.type){var a=a.output.histogram.Numbers,
g=Math.abs(a[a.length-1][0]-a[0][0])/a.length,a={id:"wcsgraph"+Date.now(),title:"WCS Test Graph",data:[a],options:barOptions(g),selectable:!1};createGraph(a)}else if("hovmollerLon"==a.type||"hovmollerLat"==a.type)(new Date(a.output.global.time)).getTime(),a={id:"wcsgraph"+Date.now(),title:"WCS Hovm\u00f6ller Test Graph",type:a.type,colour:"redToBlue",data:a.output},hovmoller(a)};
function createGraph(a){function b(b,c,d){d=Flotr._.extend(Flotr._.clone(a.options),d||{});return Flotr.draw(b,c,d)}function c(a){i=j.getEventPosition(a);Flotr.EventAdapter.observe(document,"mouseup",f);Flotr.EventAdapter.observe(document,"mousemove",d)}function d(d){var e=j.getEventPosition(d),d=j.axes.x,e=i.x-e.x;j=b(g,a.selectSeries?m():a.data,{xaxis:{min:d.min+e,max:d.max+e}});Flotr.EventAdapter.observe(j.overlay,"mousedown",c)}function f(){Flotr.EventAdapter.stopObserving(document,"mousemove",
d)}var e=opec.graphs.createDialogAlt(a.id,a.title);e.children(".graph").width(600).height(384);var g=e.children(".graph").get(0),i,j,k=0;$.each(a.data,function(a,b){b.color=k;++k});if(a.selectSeries&&!0===a.selectSeries){e.append('<div class="choices">Show:</div>');var l=e.children(".choices").css({left:620,top:20,position:"absolute"});$.each(a.data,function(a,b){l.append('<br/><input type="checkbox" name="'+a+'" checked="checked" id="id'+a+'"><label for="id'+a+'">'+b.label+"</label>")});l.find("input").click(function(){j=
b(g,m())});var m=function(){var b=[];l.find("input:checked").each(function(){var c=$(this).attr("name");c&&a.data[c]&&b.push(a.data[c])});return b}}j=b(g,a.selectSeries?m():a.data,a.options);a.draggable&&!0===a.draggable&&Flotr.EventAdapter.observe(j.overlay,"mousedown",c);a.selectable&&!0===a.selectable&&(Flotr.EventAdapter.observe(g,"flotr:select",function(c){j=b(g,a.selectSeries?m():a.data,{xaxis:{min:c.x1,max:c.x2,mode:"time",labelsAngle:45},yaxis:{min:c.y1,max:c.y2}})}),Flotr.EventAdapter.observe(g,
"flotr:click",function(){j=b(g,a.selectSeries?m():a.data)}))}function generateLineData(){for(var a=[],b=[],c=[],d=-60;60>d;d+=0.5)a.push([d,Math.sin(d)+3*Math.cos(d)]),b.push([d,Math.pow(1.1,d)]),c.push([d,d+10*Math.random()]);return[a,b,{data:c,lines:{show:!0},points:{show:!0}}]}function generateCandleData(){for(var a=[],b=3.206,c,d,f,e=-50;50>e;e++)c=Math.random(),d=Math.random(),f=Math.random()*(c+d)-d,a.push([e,b,b+c,b-d,b+f]),b+=f;return[a]}
function generateBasicTimeData(){for(var a=[],b,c=(new Date("2009/01/01 01:00")).getTime(),d=0;100>d;d++)b=c+31536E5*d,a.push([b,d+30*Math.random()+20*Math.sin(d/20+2*Math.random())+10*Math.sin(d/10+Math.random())]);return[a]}function lineOptions(){return{xaxis:{min:0,max:20},yaxis:{min:-10,max:60},title:"Example Graph",mouse:{track:!0,lineColor:"purple",relative:!0,position:"ne",sensibility:1,trackDecimals:2,trackFormatter:function(a){return"x = "+a.x+", y = "+a.y}}}}
function barOptions(a){return{bars:{show:!0,horizontal:!1,shadowsize:0,barWidth:a},title:"Example Graph",yaxis:{min:0,autoscaleMargin:1,labelsAngle:45,title:"Number of Points"},HtmlText:!1}}function candleOptions(){return{candles:{show:!0,candleWidth:0.6},xaxis:{noTicks:10},title:"Example Graph"}}function basicTimeOptions(a){return{xaxis:{mode:"time",labelsAngle:45,title:"time"},yaxis:{title:a},selection:{mode:"x"},legend:{position:"se",backgroundColor:"#D2E8FF"},HtmlText:!1,title:"Time"}}
opec.graphs.createDialogAlt=function(a,b){$(document.body).append('<div id="'+a+'-graph" class="unselectable" title="'+b+'"><div class="graph"></div></div>');var c=$("#"+a+"-graph");c.extendedDialog({position:["center","center"],width:700,height:450,resizable:!1,autoOpen:!0,close:function(){$("#"+a+"-graph").remove()},showHelp:!1,showMinimise:!0,dblclick:"collapse"});return c};
opec.graphs.createDialog=function(a,b){$(document.body).append('<div id="'+a+'-graph" class="unselectable" title="'+b+'"></div>');var c=$("#"+a+"-graph");c.extendedDialog({position:["center","center"],width:800,height:550,resizable:!1,autoOpen:!0,close:function(){$("#"+a+"-graph").remove()},showHelp:!1,showMinimise:!0,dblclick:"collapse"});return c};
function hovmoller(a){var b=a.data;opec.graphs.createDialog(a.id,a.title).children(".graph").width(760).height(504);var c=d3.selectAll("#"+a.id+"-graph").append("svg").attr("width",760).attr("height",504),d=c.append("g").attr("transform","translate(120,20)"),f=d3.time.format("%Y-%m-%dT%H:%M:%S").parse;-1!==b.data[0][0].indexOf("Z")&&(f=d3.time.format("%Y-%m-%dT%H:%M:%SZ").parse);var e=null,g=null,i=null;"hovmollerLon"==a.type?(e=d3.scale.log(),g=d3.scale.ordinal(),i=d3.time.scale().range([0,429]),
g.rangeRoundBands([0,580],0),g.domain(b.data.map(function(a){return a[1]})),i.domain(d3.extent(b.data,function(a){return f(a[0])}))):(e=d3.scale.log(),g=d3.time.scale().range([0,580]),i=d3.scale.ordinal(),g.domain(d3.extent(b.data,function(a){return f(a[0])})),i.rangeRoundBands([0,429],0),i.domain(b.data.map(function(a){return a[1]})));for(var j=[],k=0;256>k;k++)j.push(1>0.003921569*k?0.003921569*k:1);e.domain([d3.min(b.data,function(a){return a[2]}),d3.max(b.data,function(a){return a[2]})]).domain(j.map(e.invert)).range("rgb(0,0,0) rgb(144,0,111) rgb(141,0,114) rgb(138,0,117) rgb(135,0,120) rgb(132,0,123) rgb(129,0,126) rgb(126,0,129) rgb(123,0,132) rgb(120,0,135) rgb(117,0,138) rgb(114,0,141) rgb(111,0,144) rgb(108,0,147) rgb(105,0,150) rgb(102,0,153) rgb(99,0,156) rgb(96,0,159) rgb(93,0,162) rgb(90,0,165) rgb(87,0,168) rgb(84,0,171) rgb(81,0,174) rgb(78,0,177) rgb(75,0,180) rgb(72,0,183) rgb(69,0,186) rgb(66,0,189) rgb(63,0,192) rgb(60,0,195) rgb(57,0,198) rgb(54,0,201) rgb(51,0,204) rgb(48,0,207) rgb(45,0,210) rgb(42,0,213) rgb(39,0,216) rgb(36,0,219) rgb(33,0,222) rgb(30,0,225) rgb(27,0,228) rgb(24,0,231) rgb(21,0,234) rgb(18,0,237) rgb(15,0,240) rgb(12,0,243) rgb(9,0,246) rgb(6,0,249) rgb(0,0,252) rgb(0,0,255) rgb(0,5,255) rgb(0,10,255) rgb(0,16,255) rgb(0,21,255) rgb(0,26,255) rgb(0,32,255) rgb(0,37,255) rgb(0,42,255) rgb(0,48,255) rgb(0,53,255) rgb(0,58,255) rgb(0,64,255) rgb(0,69,255) rgb(0,74,255) rgb(0,80,255) rgb(0,85,255) rgb(0,90,255) rgb(0,96,255) rgb(0,101,255) rgb(0,106,255) rgb(0,112,255) rgb(0,117,255) rgb(0,122,255) rgb(0,128,255) rgb(0,133,255) rgb(0,138,255) rgb(0,144,255) rgb(0,149,255) rgb(0,154,255) rgb(0,160,255) rgb(0,165,255) rgb(0,170,255) rgb(0,176,255) rgb(0,181,255) rgb(0,186,255) rgb(0,192,255) rgb(0,197,255) rgb(0,202,255) rgb(0,208,255) rgb(0,213,255) rgb(0,218,255) rgb(0,224,255) rgb(0,229,255) rgb(0,234,255) rgb(0,240,255) rgb(0,245,255) rgb(0,250,255) rgb(0,255,255) rgb(0,255,247) rgb(0,255,239) rgb(0,255,231) rgb(0,255,223) rgb(0,255,215) rgb(0,255,207) rgb(0,255,199) rgb(0,255,191) rgb(0,255,183) rgb(0,255,175) rgb(0,255,167) rgb(0,255,159) rgb(0,255,151) rgb(0,255,143) rgb(0,255,135) rgb(0,255,127) rgb(0,255,119) rgb(0,255,111) rgb(0,255,103) rgb(0,255,95) rgb(0,255,87) rgb(0,255,79) rgb(0,255,71) rgb(0,255,63) rgb(0,255,55) rgb(0,255,47) rgb(0,255,39) rgb(0,255,31) rgb(0,255,23) rgb(0,255,15) rgb(0,255,0) rgb(8,255,0) rgb(16,255,0) rgb(24,255,0) rgb(32,255,0) rgb(40,255,0) rgb(48,255,0) rgb(56,255,0) rgb(64,255,0) rgb(72,255,0) rgb(80,255,0) rgb(88,255,0) rgb(96,255,0) rgb(104,255,0) rgb(112,255,0) rgb(120,255,0) rgb(128,255,0) rgb(136,255,0) rgb(144,255,0) rgb(152,255,0) rgb(160,255,0) rgb(168,255,0) rgb(176,255,0) rgb(184,255,0) rgb(192,255,0) rgb(200,255,0) rgb(208,255,0) rgb(216,255,0) rgb(224,255,0) rgb(232,255,0) rgb(240,255,0) rgb(248,255,0) rgb(255,255,0) rgb(255,251,0) rgb(255,247,0) rgb(255,243,0) rgb(255,239,0) rgb(255,235,0) rgb(255,231,0) rgb(255,227,0) rgb(255,223,0) rgb(255,219,0) rgb(255,215,0) rgb(255,211,0) rgb(255,207,0) rgb(255,203,0) rgb(255,199,0) rgb(255,195,0) rgb(255,191,0) rgb(255,187,0) rgb(255,183,0) rgb(255,179,0) rgb(255,175,0) rgb(255,171,0) rgb(255,167,0) rgb(255,163,0) rgb(255,159,0) rgb(255,155,0) rgb(255,151,0) rgb(255,147,0) rgb(255,143,0) rgb(255,139,0) rgb(255,135,0) rgb(255,131,0) rgb(255,127,0) rgb(255,123,0) rgb(255,119,0) rgb(255,115,0) rgb(255,111,0) rgb(255,107,0) rgb(255,103,0) rgb(255,99,0) rgb(255,95,0) rgb(255,91,0) rgb(255,87,0) rgb(255,83,0) rgb(255,79,0) rgb(255,75,0) rgb(255,71,0) rgb(255,67,0) rgb(255,63,0) rgb(255,59,0) rgb(255,55,0) rgb(255,51,0) rgb(255,47,0) rgb(255,43,0) rgb(255,39,0) rgb(255,35,0) rgb(255,31,0) rgb(255,27,0) rgb(255,23,0) rgb(255,19,0) rgb(255,15,0) rgb(255,11,0) rgb(255,7,0) rgb(255,3,0) rgb(255,0,0) rgb(250,0,0) rgb(245,0,0) rgb(240,0,0) rgb(235,0,0) rgb(230,0,0) rgb(225,0,0) rgb(220,0,0) rgb(215,0,0) rgb(210,0,0) rgb(205,0,0) rgb(200,0,0) rgb(195,0,0) rgb(190,0,0) rgb(185,0,0) rgb(180,0,0) rgb(175,0,0) rgb(170,0,0) rgb(165,0,0) rgb(160,0,0) rgb(155,0,0) rgb(150,0,0) rgb(145,0,0) rgb(140,0,0) rgb(135,0,0) rgb(130,0,0) rgb(125,0,0) rgb(120,0,0) rgb(115,0,0) rgb(110,0,0) rgb(105,0,0) rgb(0,0,0)".split(" "));
"hovmollerLon"==a.type?(j=d3.svg.axis().scale(g).tickSize(1).orient("bottom").ticks(8).tickValues([d3.min(b.data,function(a){return a[1]}),d3.max(b.data,function(a){return a[1]})]),k=d3.svg.axis().scale(i).tickSize(1).orient("left")):(j=d3.svg.axis().scale(g).tickSize(1).ticks(6).orient("bottom"),k=d3.svg.axis().scale(i).tickSize(1).orient("left").ticks(8).tickValues([d3.min(b.data,function(a){return a[1]}),d3.max(b.data,function(a){return a[1]})]));"hovmollerLon"==a.type?(d.append("g").attr("class",
"xaxis").attr("transform","translate(0,440)").call(j).append("text").attr("y",30).attr("x",290).attr("dy",".71em").style("text-anchor","end").text("Longitude"),d.append("g").attr("class","yaxis"),d.select(".yaxis").call(k).append("text").attr("transform","rotate(270)").attr("y",-80).attr("x",-214.5).attr("dy",".71em").style("text-anchor","end").text("Time"),d.selectAll("rects").data(b.data).enter().append("rect").attr("x",function(a){return g(a[1])}).attr("y",function(a){return i(f(a[0]))}).attr("width",
g.rangeBand()).attr("height",function(){return 8}).style("fill",function(a){return e(0<a[2]?a[2]:0.0010)})):(d.append("g").attr("class","xaxis").attr("transform","translate(0,440)").call(j).append("text").attr("y",30).attr("x",290).attr("dy",".71em").style("text-anchor","end").text("Time"),d.append("g").attr("class","yaxis"),d.select(".yaxis").call(k).append("text").attr("transform","rotate(270)").attr("y",-80).attr("x",-214.5).attr("dy",".71em").style("text-anchor","end").text("Latitude"),d.selectAll("rects").data(b.data).enter().append("rect").attr("x",
function(a){return g(f(a[0]))}).attr("y",function(a){return i(a[1])}).attr("width",function(){return 8}).attr("height",i.rangeBand()).style("fill",function(a){return e(0<a[2]?a[2]:0.0010)}));d.selectAll(".xaxis text").attr("transform","translate("+580/365/2+",0)");a=c.append("defs").append("linearGradient").attr("id","gradient").attr("y1","0%").attr("y1","0%").attr("y2","100%").attr("x2","0%").attr("spreadMethod","pad");a.append("stop").attr("offset","0%").attr("stop-color",e(e.domain()[255])).attr("stop-opacity",
1);a.append("stop").attr("offset","0.5%").attr("stop-color",e(e.domain()[254])).attr("stop-opacity",1);a.append("stop").attr("offset","6.25%").attr("stop-color",e(e.domain()[240])).attr("stop-opacity",1);a.append("stop").attr("offset","12.5%").attr("stop-color",e(e.domain()[224])).attr("stop-opacity",1);a.append("stop").attr("offset","18.75%").attr("stop-color",e(e.domain()[208])).attr("stop-opacity",1);a.append("stop").attr("offset","25%").attr("stop-color",e(e.domain()[192])).attr("stop-opacity",
1);a.append("stop").attr("offset","31.25%").attr("stop-color",e(e.domain()[176])).attr("stop-opacity",1);a.append("stop").attr("offset","37.5%").attr("stop-color",e(e.domain()[160])).attr("stop-opacity",1);a.append("stop").attr("offset","43.75%").attr("stop-color",e(e.domain()[144])).attr("stop-opacity",1);a.append("stop").attr("offset","50%").attr("stop-color",e(e.domain()[128])).attr("stop-opacity",1);a.append("stop").attr("offset","56.25%").attr("stop-color",e(e.domain()[112])).attr("stop-opacity",
1);a.append("stop").attr("offset","62.5%").attr("stop-color",e(e.domain()[96])).attr("stop-opacity",1);a.append("stop").attr("offset","68.75%").attr("stop-color",e(e.domain()[80])).attr("stop-opacity",1);a.append("stop").attr("offset","75%").attr("stop-color",e(e.domain()[64])).attr("stop-opacity",1);a.append("stop").attr("offset","81.25%").attr("stop-color",e(e.domain()[48])).attr("stop-opacity",1);a.append("stop").attr("offset","87.5%").attr("stop-color",e(e.domain()[32])).attr("stop-opacity",1);
a.append("stop").attr("offset","93.75%").attr("stop-color",e(e.domain()[16])).attr("stop-opacity",1);a.append("stop").attr("offset","99.9%").attr("stop-color",e(e.domain()[1])).attr("stop-opacity",1);a.append("stop").attr("offset","100%").attr("stop-color",e(e.domain()[0])).attr("stop-opacity",1);c.append("g").attr("class","legend_group").append("rect").attr("class","legend").attr("width",20).attr("height",286).style("fill","url(#gradient)").attr("transform","translate(710,42.9)");a=[e.domain()[255],
e.domain()[192],e.domain()[128],e.domain()[64],e.domain()[0]];c.select("g.legend_group").selectAll(".labels").data(a).enter().append("text").text(function(a){return opec.utils.ceil3places(a)}).attr("class","labels").attr("transform",function(a,b){return"translate("+[735,71.5*(b-0.5)+85.8]+")"})}
opec.graphs.timeSeriesChart=function(){var a=d3.time.scale().range([0,960]),b=d3.scale.linear().range([500,0]);d3.scale.category10();d3.svg.axis().scale(a).orient("bottom");d3.svg.axis().scale(b).orient("left");d3.svg.line().iterpolate("basis").x(function(b){return a(b.x)}).y(function(a){return b(a.y)})};
opec.graphs.histogramChart=function(){function a(a){a.each(function(a){a=f(a);e.domain(a.map(function(a){return a.x})).rangeRoundBands([0,c-b.left-b.right],0.1);g.domain([0,d3.max(a,function(a){return a.y})]).range([d-b.top-b.bottom,0]);var i=d3.select(this).selectAll("svg").data([a]),j=i.enter().append("svg").append("g");j.append("g").attr("class","bars");j.append("g").attr("class","x axis");j.append("g").attr("class","y axis");i.attr("width",c).attr("height",d);j=i.select("g").attr("transform",
"translate("+b.left+","+b.top+")");a=i.select(".bars").selectAll(".bar").data(a);a.enter().append("rect");a.exit().remove();a.attr("width",e.rangeBand()).attr("x",function(a){return e(a.x)}).attr("y",function(a){return g(a.y)}).attr("height",function(a){return g.range()[0]-g(a.y)}).order();j.select(".x.axis").attr("transform","translate(0,"+g.range()[0]+")")})}var b={top:0,right:0,bottom:20,left:0},c=700,d=450,f=d3.layout.histogram(),e=d3.scale.ordinal(),g=d3.scale.linear(),i=d3.svg.axis().scale(e).orient("bottom").tickSize(6,
0);d3.svg.axis().scale(g).orient("left");a.margin=function(c){if(!arguments.length)return b;b=c;return a};a.width=function(b){if(!arguments.length)return c;c=b;return a};a.height=function(b){if(!arguments.length)return d;d=b;return a};d3.rebind(a,f,"value","range","bins");d3.rebind(a,i,"tickFormat");return a};opec.utils={};opec.utils.replace=function(a,b,c,d){var f=0,e=0,g="",i="",j=0,k=0,a=[].concat(a),b=[].concat(b),l=b instanceof Array,m=c instanceof Array,c=[].concat(c);d&&(this.window[d]=0);f=0;for(j=c.length;f<j;f++)if(""!==c[f]){e=0;for(k=a.length;e<k;e++)g=c[f]+"",i=l?void 0!==b[e]?b[e]:"":b[0],c[f]=g.split(a[e]).join(i),d&&c[f]!==g&&(this.window[d]+=(g.length-c[f].length)/a[e].length)}return m?c:c[0]};
opec.utils.arrayDeDupe=function(a){var b,c=a.length,d=[],f={};for(b=0;b<c;b++)f[a[b]]=0;for(b in f)d.push(b);return d};opec.utils.arrayRemove=function(a,b,c){c=a.slice((c||b)+1||a.length);a.length=0>b?a.length+b:b;return a.push.apply(a,c)};getNearestInArray=function(a,b){var c=null;$.each(a,function(a,f){if(null===c||Math.abs(f-b)<Math.abs(c-b))c=f});return c};opec.utils.ISODateString=function(a){function b(a){return 10>a?"0"+a:a}return a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())};
opec.utils.displayDateString=function(a){var b=a.substring(0,4),c=a.substring(5,7);return a.substring(8,10)+"-"+c+"-"+b};function getObjectKey(a,b){for(var c in a)if(a[c]==b)return c;return null}opec.utils.sortDates=function(a,b){return a[0]-b[0]};opec.utils.ceil1places=function(a){return Math.ceil(10*a)/10};opec.utils.ceil3places=function(a){return Math.ceil(1E3*a)/1E3};opec.leftPanel={};
opec.leftPanel.setup=function(){$("#opec-lPanel-operational").sortable({axis:"y",distance:10,handle:"h3",update:function(){opec.leftPanel.updateGroupOrder($(this))}}).disableSelection();$("#opec-lPanel-reference").sortable({axis:"y",distance:10,update:function(){opec.leftPanel.updateGroupOrder($(this))}});opec.leftPanel.addDummyHelpLayer();opec.leftPanel.addNextGroupToPanel($("#opec-lPanel-operational"));$(".triggerL").click(function(){$(".lPanel").toggle("fast");$(this).toggleClass("active");return!1});
$("#triggerL-buttonset").buttonset();$("#triggerL-add-accordion").button({label:"Add a new group",icons:{primary:"ui-icon-circle-plus"},text:!1}).click(function(){var a=$(".lPanel .opec-tab-content:visible");opec.leftPanel.addNextGroupToPanel(a)});$("#triggerL-add-group").button();$(".lPanel .opec-tab-group").buttonset();$("#opec-lpanel-tab-operational").button();$("#opec-lpanel-tab-reference").button();$("#opec-lpanel-tab-options").button();$(".lPanel .opec-tab-group :button").click(function(){var a=
$(this).attr("href");$("#opec-lPanel-content .opec-tab-content").filter(function(){return $(this).attr("id")!=a.slice(1)}).hide("fast");$(a).show("fast")})};
opec.leftPanel.addGroupToPanel=function(a,b,c){c.prepend('<div><h3><span class="ui-accordion-header-title">'+b+'</span></h3><div id="'+a+'" class="sensor-accordion"></div></div>');$("#"+a).parent("div").multiOpenAccordion({active:0,$panel:c,showClose:function(a){return a.is("#opec-lPanel-reference")&&1>=a.children().length?!1:!0},events:{close:function(a){opec.leftPanel.removeGroupFromPanel(a)},dropdown:function(a){a.find(".ui-accordion-header-dropdown").first().contextMenu()}}});$("#"+a).sortable({connectWith:".sensor-accordion",
appendTo:".sensor-accordion",helper:"clone",update:function(){opec.leftPanel.updateLayerOrder($(this))}}).disableSelection()};opec.leftPanel.removeGroupFromPanel=function(a){a=$("#"+a);a.length&&(a.children("li").each(function(){var a=opec.getLayerByID($(this).attr("id"));"undefined"!==typeof a&&(opec.removeOpLayer(a),$("#layers").multiselect("deselect",a.name))}),a.parent("div").multiOpenAccordion("destroy"),a.parent("div").remove())};opec.leftPanel.getFirstGroupFromPanel=function(a){return a.find(".sensor-accordion").filter(function(){return!$(this).hasClass("opec-help")}).first()};
opec.leftPanel.addNextGroupToPanel=function(a){for(var b=a.find(".sensor-accordion").filter(function(){return!$(this).hasClass("opec-help")}).length+1;0!==$("#group"+b).length;)b++;opec.leftPanel.addGroupToPanel("group"+b,"Group "+b,a)};
opec.leftPanel.addLayerToGroup=function(a,b){if(!$("#"+a.id).length&&a.displayInLayerSwitcher){b.prepend(opec.templates.layer({name:a.id,visibility:a.visibility,displayTitle:a.displayTitle,type:a.controlID}));var c=$("#"+a.id);a.events.register("loadstart",a,function(){$("#"+this.id).find('img[src="img/ajax-loader.gif"]').show()});a.events.register("loadend",a,function(){$("#"+this.id).find('img[src="img/ajax-loader.gif"]').hide()});c.find('img[src="img/ajax-loader.gif"]').hide();c.find('img[src="img/exclamation_small.png"]').hide();
"baseLayers"!=a.controlID&&a.events.register("visibilitychanged",a,function(){opec.checkLayerState(a)})}};opec.leftPanel.removeLayerFromGroup=function(a){$("#"+a.id).length&&$("#"+a.id).remove()};opec.leftPanel.updateGroupOrder=function(a){$.each(a.find(".sensor-accordion"),function(){opec.leftPanel.updateLayerOrder($(this))})};
opec.leftPanel.updateLayerOrder=function(a){var b=0;$.each(a.parent("div").nextAll("div").children(".sensor-accordion"),function(){b+=$(this).children("li").length});var c=a.sortable("toArray");0<c.length&&$.each(c,function(a,f){var e=opec.getLayerByID(f);"undefined"!==typeof e&&map.setLayerIndex(e,("opLayers"==e.controlID?map.numBaseLayers:map.numBaseLayers+map.numOpLayers)+b+c.length-a-1)})};
opec.leftPanel.addDummyHelpLayer=function(){opec.leftPanel.addGroupToPanel("Need-Help","Need Help?",$("#opec-lPanel-operational"));$("#Need-Help").addClass("opec-help").prepend('<li id="Help" class="notSelectable">You Need to add some layers! Use the <a id="dmhLayerSelection" href="#">Layer Selection</a> panel.</li>');$("#dmhLayerSelection").click(function(){$("#layerSelection").extendedDialog("isOpen")?$("#layerSelection").parent("div").fadeTo("slow",0.3,function(){$(this).fadeTo("slow",1)}):$("#layerPreloader").fadeTo("slow",
0.3,function(){$(this).fadeTo("slow",1)});return!1})};opec.rightPanel={};
opec.rightPanel.setup=function(){$(".triggerR").click(function(){$(".rPanel").toggle("fast");$(this).toggleClass("active");return!1});$("#opec-rPanel-content").children("div").multiOpenAccordion({active:[0,1]});$("#ROIButtonSet").buttonset();$("#point").button({icons:{primary:"ui-icon-drawpoint"}});$("#box").button({icons:{primary:"ui-icon-drawbox"}});$("#circle").button({icons:{primary:"ui-icon-drawcircle"}});$("#polygon").button({icons:{primary:"ui-icon-drawpoly"}});$("#opec-tab-analyses").multiOpenAccordion({collapsible:!0,
heightStyle:"content",active:[-1,-1,-1,-1]});$("#spatial").multiOpenAccordion({collapsible:!0,heightStyle:"content",active:[-1,-1]});$("#temporal").multiOpenAccordion({collapsible:!0,heightStyle:"content",active:[-1,-1]});$(".rPanel .opec-tab-group").buttonset();$("#opec-button-selection").button();$("#opec-button-analyses").button();$("#opec-button-export").button();$(".rPanel .opec-tab-group :button").click(function(){var a=$(this).attr("href");$("#opec-rPanel-content .opec-tab-content").filter(function(){return $(this).attr("id")!=
a.slice(1)}).hide("fast");$(a).show("fast")});opec.rightPanel.setupDrawingControls();opec.rightPanel.setupGraphingTools();opec.rightPanel.setupDataExport()};
opec.rightPanel.setupDrawingControls=function(){var a=new OpenLayers.Layer.Vector("POI Layer",{style:{strokeColor:"red",fillColor:"red",strokeWidth:2,fillOpacity:0.3,pointRadius:5},preFeatureInsert:function(){this.removeAllFeatures()},onFeatureInsert:function(a){var c=new OpenLayers.Geometry,c=a.geometry,a=new OpenLayers.Bounds,a=c.getBounds(),d,f,e,g,i,j,k,l=0;""!==map.ROI_Type&&"point"!=map.ROI_Type&&(c.getArea(),d=1E-6*c.getGeodesicArea(),f=a.getHeight(),e=a.getWidth(),l=c.getCentroid().x,k=c.getCentroid().y,
g=OpenLayers.Util.distVincenty(new OpenLayers.LonLat(l,a.top),new OpenLayers.LonLat(l,a.bottom)),i=OpenLayers.Util.distVincenty(new OpenLayers.LonLat(a.left,k),new OpenLayers.LonLat(a.right,k)),j=(a.getWidth()+a.getHeight())/4);switch(map.ROI_Type){case "point":$("#dispROI").html("<h3>Point ROI</h4>");$("#dispROI").append('<img src="./img/pointROI.png" title ="Point Region Of Interest" alt="Map Point" />');$("#dispROI").append("<p>Lon, Lat: "+c.x.toPrecision(4)+"&deg;, "+c.y.toPrecision(4)+"&deg;</p>");
break;case "box":k=a;$("#graphcreator-bbox").size()&&($("#graphcreator-bbox").val(k.toBBOX(5,!1)),opec.selection.bbox=k.toBBOX(5,!1),$(opec.selection).trigger("selection_updated",{bbox:!0}));$("#dispROI").html("<h3>Rectangular ROI</h4>");$("#dispROI").append('<canvas id="ROIC" width="100" height="100"></canvas>');c=document.getElementById("ROIC");c=c.getContext("2d");c.lineWidth=4;c.fillStyle="#CCCCCC";j=e>f?90/e:90/f;c.fillRect(5,5,e*j,f*j);c.strokeRect(5,5,e*j,f*j);$("#dispROI").append("<p>Width: "+
e.toPrecision(4)+"&deg; ("+i.toPrecision(4)+" km)</p>");$("#dispROI").append("<p>Height: "+f.toPrecision(4)+"&deg; ("+g.toPrecision(4)+" km)</p>");$("#dispROI").append("<p>Projected Area: "+d.toPrecision(4)+" km<sup>2</sup></p>");break;case "circle":$("#dispROI").html("<h3>Circular ROI</h4>");$("#dispROI").append('<img src="./img/circleROI.png" title ="Circular Region Of Interest" alt="Map Point" />');$("#dispROI").append("<p>Radius: "+j.toPrecision(4)+"&deg;</p>");$("#dispROI").append("<p>Centre lat, lon: "+
k.toPrecision(4)+", "+l.toPrecision(4)+"</p>");$("#dispROI").append("<p>Width: "+e.toPrecision(4)+"&deg; ("+i.toPrecision(4)+" km)</p>");$("#dispROI").append("<p>Height: "+f.toPrecision(4)+"&deg; ("+g.toPrecision(4)+" km)</p>");$("#dispROI").append("<p>Projected Area: "+d.toPrecision(4)+" km<sup>2</sup></p>");break;case "polygon":g=c.getVertices();$("#dispROI").html("<h3>Custom Polygon ROI</h4>");$("#dispROI").append('<canvas id="ROIC" width="100" height="100"></canvas>');c=document.getElementById("ROIC");
c=c.getContext("2d");c.lineWidth=4;c.fillStyle="#CCCCCC";j=e>f?90/e:90/f;c.beginPath();f=5+(g[0].x-a.left)*j;e=5+(a.top-g[0].y)*j;c.moveTo(f,e);i=1;for(var m=g.length;i<m;i++)c.lineTo(5+(g[i].x-a.left)*j,5+(a.top-g[i].y)*j);c.lineTo(f,e);c.stroke();c.fill();c.closePath();$("#dispROI").append("<p>Centroid Lat, Lon:"+k.toPrecision(4)+"&deg;, "+l.toPrecision(4)+"&deg;</p>");$("#dispROI").append("<p>Projected Area: "+d.toPrecision(4)+" km<sup>2</p>")}},rendererOptions:{zIndexing:!0}});a.controlID="poiLayer";
a.displayInLayerSwitcher=!1;map.addLayer(a);opec.mapControls.point=new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Point);opec.mapControls.box=new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0,persist:!1}});opec.mapControls.circle=new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:50},persist:!1});opec.mapControls.polygon=new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Polygon);map.addControls([opec.mapControls.point,
opec.mapControls.box,opec.mapControls.circle,opec.mapControls.polygon]);$("#ROIButtonSet input:radio").click(function(){opec.toggleControl(this);a.removeAllFeatures();map.ROI_Type=this.value});$("#panZoom label.ui-button, #ROIButtonSet label.ui-button").unbind("mousedown").unbind("mouseup").unbind("mouseover").unbind("mouseout").unbind("click",function(a){h.disabled&&(a.preventDefault(),a.stopImmediatePropagation())}).bind("mousedown",function(){$(this).addClass("opec_click")}).bind("mouseup",function(){$(this).hasClass("opec_click")&&
$(this).click();$(this).removeClass("opec_click")})};
opec.rightPanel.setupGraphingTools=function(){$("#opec-graphing").append(opec.templates.graphCreatorWindow({advanced:!0}));var a=$("#graphCreator"),b=a.find("#graphcreator-generate").first();$("#graphcreator-time, #graphcreator-time2").datepicker({showButtonPanel:!0,dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0});var c=$("#viewDate").datepicker("getDate");""!==c&&($("#graphcreator-time").datepicker("setDate",c),$("#graphcreator-time2").datepicker("setDate",c));c=$(".selectedLayer:visible").attr("id");
"undefined"!==typeof c&&(c=opec.getLayerByID(c),$("#graphcreator-baseurl").val(c.wcsURL),$("#graphcreator-coverage").val(c.origName));$(".lPanel").bind("selectedLayer",function(){var a=opec.getLayerByID($(".selectedLayer:visible").attr("id"));$("#graphcreator-baseurl").val(a.wcsURL);$("#graphcreator-coverage").val(a.origName)});b.find('img[src="img/ajax-loader.gif"]').hide();$("#graphcreator-bbox").click(function(){opec.gritter.showNotification("bbox",null)});$(".ui-control-header").click(function(){$(this).toggleClass("ui-control-header-active").find("> .ui-icon").toggleClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").end().next().toggleClass("ui-control-content-active").slideToggle();
return!1});$("#graphcreator-coverage-button").click(function(){$.each($(".sensor-accordion").children("li").children(":checkbox").get().reverse(),function(){if($(this).is(":checked")){var a=$(this).parent("li").attr("id"),a=opec.getLayerByID(a);$("#graphcreator-coverage").val(a.origName);$("#graphcreator-baseurl").val(a.wcsURL)}});return!1});a.unbind(".loadGraph").bind("ajaxStart.loadGraph",function(){$(this).find('img[src="img/ajax-loader.gif"]').show()}).bind("ajaxStop.loadGraph",function(){$(this).find('img[src="img/ajax-loader.gif"]').hide()});
$("#graphcreator-barwidth-button").click(function(){return!1});$("#histogram-inputs-header").trigger("click");$("#advanced-inputs-header").trigger("click");$("#graph-format-header").trigger("click");b.on("click",":button",function(){var a=$("#graphcreator-time").val();""!==$("#graphcreator-time2").val()&&(a+="/"+$("#graphcreator-time2").val());var b=null,c=null;"hovmollerLon"==$("#graphcreator-type").val()?(b="Lon",c="Time"):"hovmollerLat"==$("#graphcreator-type").val()&&(b="Time",c="Lat");a={baseurl:$("#graphcreator-baseurl").val(),
coverage:$("#graphcreator-coverage").val(),type:$("#graphcreator-type").val(),bins:$("#graphcreator-bins").val(),time:a,bbox:$("#graphcreator-bbox").val(),graphXAxis:b,graphYAxis:c,graphZAxis:$("#graphcreator-coverage").val()};a=$.param(a);$.ajax({type:"GET",url:opec.wcsLocation+a,dataType:"json",asyc:!0,success:function(a){opec.graphs.create(a)},error:function(a,b,c){gritterErrorHandler({type:"wcs data",request:a,errorType:b,exception:c,url:this.url})}})})};
opec.rightPanel.setupDataExport=function(){function a(){var a=$.param(g);f.attr("href",e+a)}var b=$("#dataTools"),c=b.children("div").first(),d=c.next("div"),f=b.children("a").first(),e=null,g={service:"WCS",version:"1.0.0",request:"GetCoverage",crs:"OGC:CRS84",format:"NetCDF3"},b=$(".selectedLayer:visible").attr("id");"undefined"!==typeof b&&(b=opec.getLayerByID(b),c.html("<b>Selected Layer: </b>"+b.displayTitle),g.coverage=b.urlName,e=b.wcsURL,a());$(".lPanel").bind("selectedLayer",function(){var b=
opec.getLayerByID($(".selectedLayer:visible").attr("id"));c.html("<b>Selected Layer: </b>"+b.displayTitle);g.coverage=b.urlName;e=b.wcsURL;a()});$(opec.selection).bind("selection_updated",function(b,c){if("undefinded"!==typeof c.bbox&&c.bbox){var e=opec.selection.bbox.split(",");d.html("<b>Selected Bbox: </b>"+e[0]+", "+e[1]+", "+e[2]+", "+e[3]);g.bbox=opec.selection.bbox;a()}});f.click(function(){if("#"==$(this).attr("href")&&"No Data To Download"!=$(this).text())return f.text("No Data To Download"),
setTimeout(function(){f.text("Download Data")},1E3),!1;if("Download Data"!=$(this).text())return!1})};opec.contextMenu={};
opec.contextMenu.setup=function(){$.contextMenu.types.slider=function(a,b,c){$('<div id="'+a.id+'" class="context-menu slider"></div>').appendTo(this).on("click","> li",function(){console.log("Clicked on "+$(this).text());c.$menu.trigger("contextmenu:hide")}).slider({max:1,min:0,value:1,step:0.05,change:function(){opec.getLayerByID($(".selectedLayer:visible").attr("id")).setOpacity($("#"+a.id).slider("value"));return!0}});c.$menu.on("contextmenu:focus",function(){var b=opec.getLayerByID($(".selectedLayer:visible").attr("id"));("undefined"===
typeof b.opacity||null===b.opacity)&&b.setOpacity(1);$("#"+a.id).slider("value",b.opacity)})};$.contextMenu({selector:".selectedLayer",build:function(a){var b=opec.getLayerByID($(".selectedLayer:visible").attr("id")),c={fold1:{name:"Opacity",items:{opacitySlider:{type:"slider",customName:"Opacity Slider",id:"opacitySlider"}}}},d={fold3:{name:"Layer Styles",items:opec.contextMenu.getCurrentStyles(a)}},f={fold2:{name:"Layer Elevation",items:opec.contextMenu.getCurrentElevation(a)}},a={showScalebar:opec.contextMenu.showScalebar(a),
showMetadata:opec.contextMenu.showMetadata(a),showGraphCreator:opec.contextMenu.showGraphCreator(),viewData:opec.contextMenu.viewData(a),heatmap:opec.contextMenu.heatmapTest()};return{items:"opLayers"==b.controlID?b.elevation?$.extend(!0,c,d,f,a):$.extend(!0,c,d,a):$.extend(!0,c,a)}}});$.contextMenu({selector:".preloaderContextMenu",build:function(a,b){b.preventDefault();return{items:{showMetadata:opec.contextMenu.showMetadata(a)}}}});$.contextMenu({selector:".ui-accordion-header-dropdown",build:function(a){return{items:{selectAll:opec.contextMenu.selectAll(a),
deselectAll:opec.contextMenu.deselectAll(a),saveToProfile:opec.contextMenu.saveToProfile(),renameGroup:opec.contextMenu.renameGroup(a)}}}})};
opec.contextMenu.heatmapTest=function(){return{name:"Test Heatmap",callback:function(){for(var a={max:46,data:[]},a=[{lat:33.5363,lng:-117.044,count:1},{lat:33.5608,lng:-117.24,count:1},{lat:38,lng:-97,count:1},{lat:38.9358,lng:-77.1621,count:1}],b=a.length,c={data:[]};b--;)c.data.push({lonlat:new OpenLayers.LonLat(a[b].lng,a[b].lat),count:a[b].count});a=c;b=new OpenLayers.Layer.Vector;c=new OpenLayers.Layer.Heatmap("Heatmap Layer",map,b,{visible:!0,radius:10},{isBaseLayer:!1,opacity:0.3,projection:new OpenLayers.Projection("EPSG:4326")});
map.addLayers([b,c]);c.setDataSet(a)}}};opec.contextMenu.selectAll=function(a){return{name:"Select All",callback:function(){a.parent().parent().next("div").find('[type="checkbox"]').each(function(){var a=$(this);a.is(":checked")||(a.trigger("click"),a.attr("checked","checked"))})}}};opec.contextMenu.deselectAll=function(a){return{name:"Deselect All",callback:function(){a.parent().parent().next("div").find('[type="checkbox"]').each(function(){var a=$(this);a.is(":checked")&&(a.trigger("click"),a.removeAttr("checked"))})}}};
opec.contextMenu.saveToProfile=function(){return{name:"Save To Profile",callback:function(){}}};opec.contextMenu.renameGroup=function(a){return{name:"Rename Group",callback:function(){a.parent().parent().parent().multiOpenAccordion("renameGroup")}}};
opec.contextMenu.viewData=function(a){var b="",c=null;a.attr("id")?(b=a.attr("id"),c=opec.getLayerByID(b)):(b=a.text(),c=opec.microLayers[b]);return{name:"Zoom To Data",callback:function(){if(null!==c){var a=(new OpenLayers.Bounds(c.exBoundingBox.WestBoundLongitude,c.exBoundingBox.SouthBoundLatitude,c.exBoundingBox.EastBoundLongitude,c.exBoundingBox.NorthBoundLatitude)).transform(map.displayProjection,map.projection);map.zoomToExtent(a)}}}};
opec.contextMenu.showMetadata=function(a){var b="",c=null;a.attr("id")?(b=a.attr("id"),c=opec.getLayerByID(b)):(b=a.text(),c=opec.microLayers[b]);return{name:"Show Metadata",callback:function(){opec.window.createMetadata(c)}}};opec.contextMenu.showScalebar=function(a){return{name:"Show Scalebar",callback:function(){opec.window.createScalebar(a)}}};
opec.contextMenu.getCurrentStyles=function(a){var b=opec.getLayerByID(a.attr("id"));if("opLayers"!=b.controlID)return[];var c=[],a=b.styles.slice();a.push({Name:"Remove Style",Abstract:"",LegendURL:"",Width:0,Height:0});$.each(a,function(a,f){c["Layer Styles"+a]={name:f.Name,className:f.Name==b.params.STYLES?"styleSelected":"",callbackName:"Layer Styles "+f.Name,callback:function(){var a=opec.getLayerByID($(".selectedLayer:visible").attr("id"));a.mergeNewParams({styles:"Remove Style"==f.Name?"":f.Name});
console.log(f.Name);updateScalebar(a)}}});return c};opec.contextMenu.getCurrentElevation=function(a){var b=opec.getLayerByID(a.attr("id")),c=[];$.each(b.elevationCache,function(a,f){c["Layer Elevation "+a]={name:parseFloat(f).toFixed(3)+" "+b.elevationUnits,className:f==b.params.ELEVATION?"elevationSelected":"",callbackName:"Layer Elevation "+f,callback:function(){opec.getLayerByID($(".selectedLayer:visible").attr("id")).mergeNewParams({elevation:f})}}});return c};
opec.contextMenu.showGraphCreator=function(){return{name:"Show Graph Creator",callback:function(){}}};OpenLayers.Map.prototype.cesiumLoaded=null;OpenLayers.Map.prototype.sampleLayers=["metOffice: no3","ogs: chl","Motherloade: v_wind","HiOOS: CRW_SST"];OpenLayers.Map.prototype.enabledDays=[];OpenLayers.Map.prototype.getCapabilities=[];OpenLayers.Map.prototype.numBaseLayers=0;OpenLayers.Map.prototype.numRefLayers=0;OpenLayers.Map.prototype.numOpLayers=0;OpenLayers.Map.prototype.helperMessages=[];OpenLayers.Map.prototype.ROI_Type="";OpenLayers.Layer.prototype.urlName="";
OpenLayers.Layer.prototype.displayTitle="";OpenLayers.Layer.prototype.title="";OpenLayers.Layer.prototype.productAbstract="";OpenLayers.Layer.prototype.displaySensorName="";OpenLayers.Layer.prototype.sensorName="";OpenLayers.Layer.prototype.firstDate="";OpenLayers.Layer.prototype.lastDate="";OpenLayers.Layer.prototype.maxScaleVal=null;OpenLayers.Layer.prototype.origMaxScaleVal=null;OpenLayers.Layer.prototype.minScaleVal=null;OpenLayers.Layer.prototype.origMinScaleVal=null;
OpenLayers.Layer.prototype.log=!1;OpenLayers.Layer.prototype.controlID="opLayers";OpenLayers.Layer.prototype.temporal=!1;OpenLayers.Layer.prototype.elevation=!1;OpenLayers.Layer.prototype.elevationDefault=null;OpenLayers.Layer.prototype.elevationUnits=null;OpenLayers.Layer.prototype.styles=[];OpenLayers.Layer.prototype.exBoundingBox=[];OpenLayers.Layer.prototype.boundingBox=[];OpenLayers.Layer.prototype.DTCache=[];OpenLayers.Layer.prototype.WFSDatesToIDs={};
OpenLayers.Layer.prototype.elevationCache=[];OpenLayers.Layer.prototype.currentDateTimes=[];OpenLayers.Layer.prototype.selectedDateTime="";OpenLayers.Layer.prototype.selected=!1;OpenLayers.Layer.prototype.globeLayer=null;OpenLayers.Layer.prototype.matchDate=function(a){var b=$.grep(this.DTCache,function(b){return b.substring(0,10)==a});return 0<b.length?b:null};
OpenLayers.Map.prototype.selectDateTimeLayer=function(a,b){if(b){var c=opec.utils.ISODateString(b),d=a.matchDate(c);d?(a.currentDateTimes=d,a.selectedDateTime=d[0],"opLayers"==a.controlID?a.mergeNewParams({time:a.selectedDateTime}):(a.removeAllFeatures(),opec.getFeature(a,a.selectedDateTime)),a.setVisibility(a.selected),console.info("Layer "+a.name+" data available for date-time "+a.selectedDateTime+". Layer selection and display: "+a.selected)):(a.currentDateTimes=[],a.selectedDateTime="",a.setVisibility(!1),
console.info("Layer "+a.name+" no data available for date-time "+c+". Not displaying layer."))}opec.checkLayerState(a)};OpenLayers.Map.prototype.filterLayersByDate=function(a){var b=this;$.each(b.layers,function(c,d){d.temporal&&b.selectDateTimeLayer(d,a)})};
OpenLayers.Map.prototype.refreshDateCache=function(){var a=this;a.enabledDays=[];$.each(a.layers,function(b,c){c.selected&&c.temporal&&(a.enabledDays=a.enabledDays.concat(c.DTCache))});a.enabledDays=opec.utils.arrayDeDupe(a.enabledDays);console.info("Global date cache now has "+a.enabledDays.length+" members.")};OpenLayers.Map.prototype.allowedDays=function(a){var b=opec.utils.ISODateString(a);return 0<$.grep(this.enabledDays,function(a){return a.substring(0,10)==b}).length?[!0]:[!1]};
OpenLayers.Map.prototype.getLayerData=function(a,b){$.ajax({type:"GET",url:"./cache/layers/"+a,dataType:"json",asyc:!0,cache:!1,success:function(a){opec.createOpLayer(a,b);opec.addOpLayer(b.providerTag+": "+b.name)},error:function(a,b,f){gritterErrorHandler({type:"layer cache",request:a,errorType:b,exception:f,url:this.url})}})};
OpenLayers.Map.prototype.getMetadata=function(a){$.ajax({type:"GET",url:OpenLayers.ProxyHost+a.url+encodeURIComponent("item=layerDetails&layerName="+a.urlName+"&request=GetMetadata"),dataType:"json",asyc:!0,success:function(b){a.origMinScaleVal=parseFloat(b.scaleRange[0]);a.origMaxScaleVal=parseFloat(b.scaleRange[1]);a.minScaleVal=a.origMinScaleVal;a.maxScaleVal=a.origMaxScaleVal;a.log="true"==b.log?!0:!1},error:function(b,c,d){a.origMinScaleVal=0;a.origMaxScaleVal=1;a.minScaleVal=a.origMinScaleVal;
a.maxScaleVal=a.origMaxScaleVal;a.log=!1;gritterErrorHandler({type:"layer MetaData",request:b,errorType:c,exception:d,url:this.url})}})};opec.TimeLine=function(a,b){var c=this;if($("div#"+a).length){this.id=a;this.visible=!0;this.timebars=b.timebars instanceof Array?b.timebars:[];this.barHeight=null!==b.barHeight?b.barHeight:20;this.barMargin=null!==b.barMargin?b.barMargin:4;this.now=new Date;this.selectedDate=null!==b.selectedDate?new Date(b.selectedDate):new Date;this.margin=b.chartMargins||{top:0,right:0,bottom:0,left:0};this.laneHeight=this.barHeight+2*this.barMargin+1;this.colours=d3.scale.category10();this.reHeight();this.reWidth();
var d=d3.min(this.timebars,function(a){return new Date(a.startDate)}),f=d3.max(this.timebars,function(a){return new Date(a.endDate)});if("undefined"===typeof d||null===d)d=new Date(this.selectedDate.getTime()-1577845E4);if("undefined"===typeof f||null===f)f=new Date(this.selectedDate.getTime()+1577845E4);this.xScale=d3.time.scale().domain([d,f]).range([0,this.width]);this.yScale=d3.scale.linear().domain([0,this.timebars.length]).range([0,this.height]);this.clickDate=function(){var a=d3.event.layerX,
a=a>c.xScale.range()[0]&&a<c.xScale.range()[1]?a:a-d3.event.layerX;c.draggedDate=c.xScale.invert(a);c.selectedDateLine.attr("x",function(){return d3.round(c.xScale(c.draggedDate)-1.5)});c.selectedDate=c.draggedDate;$("#viewDate").datepicker("setDate",c.selectedDate);map.filterLayersByDate(c.selectedDate)};this.zoom=d3.behavior.zoom().x(this.xScale).on("zoom",function(){c.redraw()});this.chart=d3.select("div#"+this.id).append("svg").attr("class","timeline").on("click",c.clickDate).call(c.zoom);this.main=
this.chart.append("svg:g").attr("transform","translate("+this.margin.left+","+this.margin.top+")").attr("class","main");this.separatorArea=this.main.append("svg:g");this.barArea=this.main.append("svg:g");this.dateDetailArea=this.main.append("svg:g");this.nowLine=this.main.append("svg:line").attr("class","nowLine");this.draggedDate=this.selectedDate;this.dragDate=function(){var a=c.xScale(c.draggedDate)+d3.event.dx,a=a>c.xScale.range()[0]&&a<c.xScale.range()[1]?a:a-d3.event.dx;c.draggedDate=c.xScale.invert(a);
c.selectedDateLine.attr("x",function(){return d3.round(c.xScale(c.draggedDate)-1.5)})};this.dragDateEnd=function(){c.selectedDate=c.draggedDate;$("#viewDate").datepicker("setDate",c.selectedDate);map.filterLayersByDate(c.selectedDate)};this.selectedDateLine=this.main.append("svg:rect").attr("cursor","e-resize").attr("class","selectedDateLine").call(d3.behavior.drag().origin(Object).on("drag",c.dragDate).on("dragend",c.dragDateEnd));this.xAxis=d3.svg.axis().scale(c.xScale).orient("bottom").tickSize(6,
0,0);this.main.append("svg:g").attr("transform","translate(0,"+d3.round(this.height+0.5)+")").attr("class","axis");this.labelArea=this.main.append("svg:g");c.redraw();$(window).resize(function(){c.visible&&(c.reWidth(),c.redraw())})}else console.error('No DIV with ID, "'+a+'" exists. Cannot render TimeLine.')};
opec.TimeLine.prototype.redraw=function(){var a=this;this.xScale.range([0,this.width]);this.yScale.domain([0,this.timebars.length]).range([0,this.height]);$("#"+this.id).height(this.chartHeight);this.main.attr("width",this.width).attr("height",this.height);this.chart.attr("width",this.chartWidth).attr("height",this.chartHeight).style("clip","rect( 0px, "+(this.width+this.margin.left)+"px, "+this.chartHeight+"px, "+this.margin.left+"px)");this.main.selectAll(".axis").attr("transform","translate(0,"+
d3.round(this.height+0.5)+")").call(this.xAxis);var b=(this.xScale.domain()[1]-this.xScale.domain()[0])/(4E7*this.width);12<b?this.xAxis.ticks(d3.time.years,d3.round(b/12)).tickFormat(d3.time.format("%Y")):12>=b&&1<b?this.xAxis.ticks(d3.time.months,getNearestInArray([1,2,3,4,6,12],b)).tickFormat(d3.time.format("%b %y")):1>=b&&b>1/7?this.xAxis.ticks(d3.time.weeks,d3.round(4.3*b)).tickFormat(d3.time.format("%d/%m/%y")):b<=1/7&&b>1/365?this.xAxis.ticks(d3.time.days,d3.round(30*b)).tickFormat(d3.time.format("%d/%m/%y")):
b<=1/365&&this.xAxis.ticks(d3.time.hours,d3.round(730*b)).tickFormat(d3.time.format("%I %p"));this.sepLines=this.separatorArea.selectAll("line").data(this.timebars);this.sepLines.enter().insert("svg:line").attr("x1",0).attr("y1",function(b,d){return d3.round(a.yScale(d)+0.5)}).attr("y2",function(b,d){return d3.round(a.yScale(d)+0.5)}).attr("class","separatorLine");b=this.sepLines.exit();b.remove();this.sepLines.attr("x2",this.width);this.bars=this.barArea.selectAll("rect").data(this.timebars);this.bars.enter().insert("svg:rect").attr("y",
function(b,d){return d3.round(a.yScale(d)+a.barMargin+0.5)}).transition().duration(500).attr("height",d3.round(a.barHeight+0.5)).attr("stroke",function(b,d){return a.colours(d)}).attr("class","timeRange");b=this.bars.exit();b.remove();this.bars.attr("x",function(b){return d3.round(a.xScale(new Date(b.startDate))+0.5)}).attr("width",function(b){return d3.round(a.xScale(new Date(b.endDate))-a.xScale(new Date(b.startDate)))});this.dateDetails=this.dateDetailArea.selectAll("g").data(this.timebars);this.dateDetails.enter().insert("svg:g").each(function(b,
d){d3.select(this).selectAll("g").data(b.dateTimes).enter().append("svg:line").attr("stroke",function(){return a.colours(d)}).attr("y1",function(){return d3.round(a.yScale(d)+a.barMargin+1.5)}).attr("y2",function(){return d3.round(a.yScale(d)+a.laneHeight-a.barMargin+0.5)}).attr("class","detailLine")});b=this.dateDetails.exit();b.remove();this.main.selectAll(".detailLine").attr("x1",function(b){return d3.round(a.xScale(new Date(b))+0.5)}).attr("x2",function(b){return d3.round(a.xScale(new Date(b))+
0.5)});this.nowLine.attr("x1",d3.round(a.xScale(a.now)+0.5)).attr("y1",0).attr("x2",d3.round(a.xScale(a.now)+0.5)).attr("y2",a.height);this.selectedDateLine.attr("x",function(){return d3.round(a.xScale(a.selectedDate)-1.5)}).attr("y",2).attr("width",4).attr("height",a.height-2);this.labels=this.labelArea.selectAll("text").data(this.timebars);this.labels.enter().insert("svg:text").text(function(a){return a.label}).attr("x",1.5).attr("y",function(b,d){return d3.round(a.yScale(d+0.5))}).attr("dy","0.7ex").attr("text-anchor",
"end").attr("class","laneText");b=this.labels.exit();b.remove()};opec.TimeLine.prototype.reHeight=function(){this.height=this.laneHeight*this.timebars.length;0===this.height&&(this.height=25);this.chartHeight=this.height+this.margin.top+this.margin.bottom+20};opec.TimeLine.prototype.reWidth=function(){this.chartWidth=$("div#"+this.id).width();this.width=this.chartWidth-this.margin.right-this.margin.left};
opec.TimeLine.prototype.reset=function(){this.zoom.translate([0,0]).scale(1);this.reHeight();this.reWidth();this.redraw()};opec.TimeLine.prototype.zoomDate=function(a,b){var c=new Date(a),d=new Date(b);this.minDate=c instanceof Date?c:this.minDate;this.maxDate=c instanceof Date?d:this.maxDate;this.xScale.domain([this.minDate,this.maxDate]);this.redraw()};
opec.TimeLine.prototype.hide=function(){this.chart.transition().duration(800).attr("height",0);this.main.transition().duration(800).attr("height",0);$("div#"+this.id).slideUp(1E3);this.visible=!1};opec.TimeLine.prototype.show=function(){this.chart.transition().duration(1E3).attr("height",this.chartHeight);this.main.transition().duration(1E3).attr("height",this.height);$("div#"+this.id).slideDown(800);this.visible=!0};
opec.TimeLine.prototype.addTimeBarJSON=function(a){this.timebars.push(a);this.reHeight();this.redraw()};opec.TimeLine.prototype.addTimeBar=function(a,b,c,d,f){var e={};e.name=a;e.label=b;e.startDate=c;e.endDate=d;e.dateTimes=f;this.timebars.push(e);this.reHeight();this.redraw()};opec.TimeLine.prototype.removeTimeBar=function(a){this.timebars.splice(a,1);a=this.timebars;this.timebars=[];this.reHeight();this.redraw();this.timebars=a;this.reHeight();this.redraw()};
opec.TimeLine.prototype.removeTimeBarByName=function(a){for(var b=!1,c=0;c<this.timebars.length;c++)this.timebars[c].name==a&&(this.timebars.splice(c,1),c--,b=!0);a=this.timebars;b&&(this.timebars=[],this.reHeight(),this.redraw(),this.timebars=a,this.reHeight(),this.redraw())};
opec.TimeLine.prototype.setDate=function(a){var b=this,a=b.draggedDate=new Date(a);this.selectedDate=a instanceof Date?a:this.selectedDate;this.selectedDateLine.transition().duration(1E3).attr("x",function(){return d3.round(b.xScale(b.selectedDate)-1.5)})};opec.TimeLine.prototype.getDate=function(){var a=new Date(this.selectedDate);return a instanceof Date?a:null};"undefined"!==typeof OpenLayers&&(OpenLayers.Map.prototype.globe={is3D:!1,isColumbus:!1,canvasID:null,$canvas:null,canvas:null,$mapdiv:null,ellipsoid:null,scene:null,primitives:null,cb:null,proxyUrl:null,transitioner:null,showLabels:!0,hasBaseLayer:!1,currentBaseLayer:null,baseLayers:[],initialise:function(a,b,c){c=c||{};this.canvasID=b+"_canvas";this.$mapdiv=$("#"+b);c.canvasID&&(this.canvasID=c.canvasID);c.is3D&&(this.is3D=c.is3D);c.proxy&&(this.proxyUrl=c.proxy);b=$("<div/>").attr("class","fullsize");
this.$canvas=$("<canvas/>").attr({id:this.canvasID,"class":"fullsize"});try{this.canvas=this.$canvas.get(0);b.append(this.$canvas);this.$mapdiv.append(b);this.ellipsoid=Cesium.Ellipsoid.WGS84;this.scene=new Cesium.Scene(this.canvas);this.primitives=this.scene.getPrimitives();this.cb=new Cesium.CentralBody(this.ellipsoid);this.cb.nightImageSource="img/land_ocean_ice_lights_2048.jpg";this.cb.specularMapSource="img/earthspec1k.jpg";2048<this.scene.getContext().getMaximumTextureSize()&&(this.cb.cloudsMapSource=
"img/earthcloudmaptrans.jpg",this.cb.bumpMapSource="img/earthbump1k.jpg");this.cb.showSkyAtmosphere=!1;this.cb.showGroundAtmosphere=!1;this.primitives.setCentralBody(this.cb);this.scene.getCamera().getControllers().addCentralBody();this.transitioner=new Cesium.SceneTransitioner(this.scene,this.ellipsoid);var d=this;this.scene.setAnimation(function(){var a=d.scene.getCamera();new Cesium.Cartesian4(a.position.x,a.position.y,a.position.z,1);d.scene.setSunPosition(Cesium.computeSunPosition(new Cesium.JulianDate))})}catch(f){console.log(f.message);
(b=f.stack)&&console.log(b);a.cesiumLoaded=!1;return}(function g(){try{d.scene.render()}catch(a){console.log(a.message);var b=a.stack;b&&console.log(b)}Cesium.requestAnimationFrame(g)})();b=function(){var a=d.$mapdiv.width(),b=d.$mapdiv.height();d.canvas.width===a&&d.canvas.height===b||(d.canvas.width=a,d.canvas.height=b,d.scene.getCamera().frustum.aspectRatio=a/b)};window.addEventListener("resize",b,!1);b();this.canvas.oncontextmenu=function(){return!1};this.maxExtent=this.getMaxExtent();this.scene.getCamera().map=
this;a.cesiumLoaded=!0},addLayer:function(a){if(!(a instanceof OpenLayers.Layer.Vector)&&a instanceof OpenLayers.Layer.WMS){var b={url:a.url,layers:a.params.LAYERS};this.proxyUrl&&(b.proxy=new Cesium.DefaultProxy(this.proxyUrl));b.parameters=a.params||{};b=new Cesium.WebMapServiceImageryProvider(b);a.isBaseLayer?(b=new Cesium.ImageryLayer(b),b.alpha=1,b.show=!0,this.hasBaseLayer?this.baseLayers.push(b):(this.hasBaseLayer=!0,this.currentBaseLayer=b,this.cb.getImageryLayers().add(b,0))):(b=this.cb.getImageryLayers().addImageryProvider(b),
b.alpha=1,b.show=a.getVisibility());return b}},removeLayer:function(a){for(var b=this.cb.getImageryLayers(),c=0,d=b.getLength();c<d;c++){var f=b.get(c);if(f.getImageryProvider()instanceof Cesium.WebMapServiceImageryProvider&&f.getImageryProvider().getUrl()==a.url){this.cb.getImageryLayers().remove(f,!1);break}}},pan:function(a,b){var c={};c.startPosition=new Cesium.Cartesian2(0,0);c.endPosition=new Cesium.Cartesian2(a,b);c.motion=new Cesium.Cartesian2(0,0);this.scene.getCamera().getControllers().get(0)._spin(c)},
getMaxExtent:function(){return new OpenLayers.Bounds(-45,-45,45,45)},getExtent:function(){var a=this.getLonLatFromPixel({x:this.canvas.width/2,y:this.canvas.height/2}),b=this.getLonLatFromPixel({x:this.canvas.width/2,y:0}),c=this.getLonLatFromPixel({x:this.canvas.width,y:this.canvas.height/2}),d=this.getLonLatFromPixel({x:this.canvas.width/2,y:this.canvas.height}),f=this.getLonLatFromPixel({x:0,y:this.canvas.height/2});-1E3==f.lon&&(f={lat:a.lat,lon:a.lon-45},c={lat:a.lat,lon:a.lon+45});-1E3==b.lat&&
(b={lat:a.lat+45,lon:a.lon},d={lat:a.lat-45,lon:a.lon});return new OpenLayers.Bounds(f.lon,d.lat,c.lon,b.lat)},zoomIn:function(){},zoomOut:function(){},zoomToMaxExtent:function(){},zoomToExtent:function(a){a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var b=Cesium.Math.toRadians(a.left),c=Cesium.Math.toRadians(a.bottom),d=Cesium.Math.toRadians(a.right),a=Cesium.Math.toRadians(a.top);this.scene.getCamera().viewExtent(new Cesium.Extent(b,c,d,a),this.ellipsoid)},setBaseLayer:function(a){var b=
null,c=null;if(null!==this.currentBaseLayer&&this.currentBaseLayer.getImageryProvider().getUrl()!=a.url){for(var d=0,f=this.baseLayers.length;d<f;d++)a.url==this.baseLayers[d].getImageryProvider().getUrl()&&(this.cb.getImageryLayers().add(this.baseLayers[d],0),b=this.baseLayers[d],c=d);this.baseLayers.splice(c,1);this.cb.getImageryLayers().remove(this.currentBaseLayer,!1);this.baseLayers.push(this.currentBaseLayer);this.currentBaseLayer=b}}},OpenLayers.Map.prototype.setupGlobe=function(a,b,c){this.globe.initialise(a,
b,c);if(!a.cesiumLoaded)return this.globe.$canvas.parent("div").hide(),this.globe=null;this.destroy=function(){OpenLayers.Map.prototype.destroy.call(this);$(this.globe.canvas).remove()};this.addLayer=function(a){a.setVisibility=function(b){"undefined"!==typeof this.globeLayer&&(this.globeLayer.show=b);OpenLayers.Layer.prototype.setVisibility.call(a,b)};var b=this.globe.addLayer(a);a.globeLayer=b;OpenLayers.Map.prototype.addLayer.call(this,a)};this.removeLayer=function(a){this.globe.removeLayer(a);
OpenLayers.Map.prototype.removeLayer.call(this,a)};this.pan=function(a,b,c){this.is3D?this.globe.pan(a,b,c):OpenLayers.Map.prototype.pan.call(this,a,b,c)};this.zoomIn=function(){this.is3D?this.globe.zoomIn():OpenLayers.Map.prototype.zoomIn.call(this)};this.zoomOut=function(){this.is3D?this.globe.zoomOut():OpenLayers.Map.prototype.zoomOut.call(this)};this.zoomToMaxExtent=function(a){this.is3D?this.globe.zoomToMaxExtent(a):OpenLayers.Map.prototype.zoomToMaxExtent.call(this,a)};this.zoomToExtent=function(a,
b){this.is3D?this.globe.zoomToExtent(a,b):OpenLayers.Map.prototype.zoomToExtent.call(this,a,b)};this.show3D=function(){this.globe.isColumbus=!1;this.globe.is3D=!0;$(this.viewPortDiv).hide();this.globe.$canvas.parent("div").show();if(null!==this.globe.scene){var a=this.getExtent();null!==a?this.zoomToExtent(a,!1):this.zoomToMaxExtent();this.globe.cb.showSkyAtmosphere=!1;this.globe.cb.showGroundAtmosphere=!1;this.globe.cb.affectedByLighting=!1;this.globe.transitioner.to3D()}};this.showColumbus=function(){this.globe.is3D=
!0;this.globe.isColumbus=!0;$(this.viewPortDiv).hide();this.globe.$canvas.parent("div").show();if(null!==this.globe.scene){var a=this.getExtent();null!==a?this.zoomToExtent(a,!1):this.zoomToMaxExtent();this.globe.cb.showSkyAtmosphere=!1;this.globe.cb.showGroundAtmosphere=!1;this.globe.transitioner.morphToColumbusView();this.globe.cb.affectedByLighting=!1}};this.show2D=function(){this.globe.isColumbus=!1;this.globe.is3D=!1;this.globe.$canvas.parent("div").hide();$(this.viewPortDiv).show()};this.setBaseLayer=
function(a){this.globe.setBaseLayer(a);OpenLayers.Map.prototype.setBaseLayer.call(this,a)};a.globe.is3D?a.show3D():a.show2D();return this.globe});(function(a){a.gritter={};a.gritter.options={position:"",class_name:"",fade_in_speed:"medium",fade_out_speed:1E3,time:6E3};a.gritter.add=function(a){try{return b.add(a||{})}catch(d){var f="Gritter Error: "+d;"undefined"!=typeof console&&console.error?console.error(f,a):alert(f)}};a.gritter.remove=function(a,d){b.removeSpecific(a,d||{})};a.gritter.removeAll=function(a){b.stop(a||{})};var b={position:"",fade_in_speed:"",fade_out_speed:"",time:"",_custom_timer:0,_groups:[],_item_count:0,_is_setup:0,
_tpl_close:'<div class="gritter-close"></div>',_tpl_title:'<span class="gritter-title">[[title]]</span>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-top"></div><div class="gritter-item">[[close]][[image]]<div class="[[class_name]]">[[title]]<p>[[text]]</p></div><div style="clear:both"></div></div><div class="gritter-bottom"></div></div>',_tpl_wrap:'<div id="gritter-notice-wrapper"></div>',add:function(c){"string"==
typeof c&&(c={text:c});if(!c.text)throw'You must supply "text" parameter.';this._is_setup||this._runSetup();var d=c.title,f=c.text,e=c.image||"",g=c.sticky||!1,i=c.class_name||a.gritter.options.class_name,j=a.gritter.options.position,k=c.time||"";this._verifyWrapper();this._groups[c.group]?this._groups[c.group].count++:(this._groups[c.group]={},this._groups[c.group].count=1,this._groups[c.group].uid=[]);if(this._groups[c.group].count>c.max)return this._groups[c.group].count--,null;this._item_count++;
var l=this._item_count,m=this._tpl_item;a(["before_open","after_open","before_close","after_close"]).each(function(d,e){b["_"+e+"_"+l]=a.isFunction(c[e])?c[e]:function(){}});this._custom_timer=0;k&&(this._custom_timer=k);k=""!=e?'<img src="'+e+'" class="gritter-image" />':"";e=""!=e?"gritter-with-image":"gritter-without-image";d=d?this._str_replace("[[title]]",d,this._tpl_title):"";m=this._str_replace("[[title]] [[text]] [[close]] [[image]] [[number]] [[class_name]] [[item_class]]".split(" "),[d,
f,this._tpl_close,k,this._item_count,e,i],m);if(!1===this["_before_open_"+l]())return!1;a("#gritter-notice-wrapper").addClass(j).append(m);d=a("#gritter-item-"+this._item_count);d.fadeIn(this.fade_in_speed,function(){b["_after_open_"+l](a(this))});g||this._setFadeTimer(d,l);a(d).bind("mouseenter mouseleave",function(c){"mouseenter"==c.type?g||b._restoreItemIfFading(a(this),l):g||b._setFadeTimer(a(this),l);b._hoverState(a(this),c.type)});a(d).find(".gritter-close").click(function(){b.removeSpecific(c.group,
{},null,!0)});this._groups[c.group].uid.push(l);return c.group},_countRemoveWrapper:function(b,d,f){d.remove();this["_after_close_"+b](d,f);0==a(".gritter-item-wrapper").length&&a("#gritter-notice-wrapper").remove()},_fade:function(a,d,f,e){var g=f||{},f="undefined"!=typeof g.fade?g.fade:!0,g=g.speed||this.fade_out_speed;this["_before_close_"+d](a,e);e&&a.unbind("mouseenter mouseleave");f?a.animate({opacity:0},g,function(){a.animate({height:0},300,function(){b._countRemoveWrapper(d,a,e)})}):this._countRemoveWrapper(d,
a)},_hoverState:function(a,b){"mouseenter"==b?(a.addClass("hover"),a.find(".gritter-close").show()):(a.removeClass("hover"),a.find(".gritter-close").hide())},removeSpecific:function(b,d,f,e){var g=this._groups[b].uid.shift();this._groups[b].count--;f||(f=a("#gritter-item-"+g));this._fade(f,g,d||{},e)},_restoreItemIfFading:function(a,b){clearTimeout(this["_int_id_"+b]);a.stop().css({opacity:"",height:""})},_runSetup:function(){for(var b in a.gritter.options)this[b]=a.gritter.options[b];this._is_setup=
1},_setFadeTimer:function(a,d){this["_int_id_"+d]=setTimeout(function(){b._fade(a,d)},this._custom_timer?this._custom_timer:this.time)},stop:function(b){var d=a.isFunction(b.before_close)?b.before_close:function(){},f=a.isFunction(b.after_close)?b.after_close:function(){},b=a("#gritter-notice-wrapper");d(b);b.fadeOut(function(){a(this).remove();f()})},_str_replace:function(a,b,f,e){var g=0,i=0,j="",k="",l=0,m=0,a=[].concat(a),b=[].concat(b),n=b instanceof Array,p=f instanceof Array,f=[].concat(f);
e&&(this.window[e]=0);g=0;for(l=f.length;g<l;g++)if(""!==f[g]){i=0;for(m=a.length;i<m;i++)j=f[g]+"",k=n?void 0!==b[i]?b[i]:"":b[0],f[g]=j.split(a[i]).join(k),e&&f[g]!==j&&(this.window[e]+=(j.length-f[g].length)/a[i].length)}return p?f:f[0]},_verifyWrapper:function(){0==a("#gritter-notice-wrapper").length&&a("body").append(this._tpl_wrap)}}})(jQuery);
